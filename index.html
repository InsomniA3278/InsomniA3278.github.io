<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>InsomniA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="InsomniA">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="InsomniA">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="InsomniA">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="InsomniA" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">InsomniA</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-my-ls-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/29/my-ls-md/" class="article-date">
  <time datetime="2017-03-29T13:12:09.000Z" itemprop="datePublished">2017-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/29/my-ls-md/">my_ls</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#C语言编写ls程序<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pwd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;grp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFER_SIZE 1024</span></span><br><span class="line"><span class="keyword">char</span> Type[<span class="number">8</span>] = &#123;<span class="string">'p'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'b'</span>,<span class="string">'-'</span>,<span class="string">'l'</span>,<span class="string">'s'</span>&#125; ;</span><br><span class="line"><span class="keyword">char</span> Mod[<span class="number">8</span>][<span class="number">4</span>] = &#123;<span class="string">"---"</span>,<span class="string">"--x"</span>,<span class="string">"-w-"</span>,<span class="string">"-wx"</span>,<span class="string">"r--"</span>,<span class="string">"r-x"</span>,<span class="string">"rw-"</span>,<span class="string">"rwx"</span>&#125; ;</span><br><span class="line"><span class="keyword">char</span> pwd[BUFFER_SIZE] ;</span><br><span class="line"><span class="keyword">char</span> (*name)[<span class="number">256</span>] ;</span><br><span class="line"><span class="keyword">bool</span> is_l , is_a , is_s ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span>* argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,argc) ;</span><br><span class="line">    getcwd(pwd,BUFFER_SIZE) ;</span><br><span class="line">    </span><br><span class="line">    is_l = <span class="literal">false</span> ;</span><br><span class="line">    is_a = <span class="literal">false</span> ;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(argc == <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(argv[<span class="number">1</span>]) ;</span><br><span class="line">        <span class="keyword">if</span>(argv[<span class="number">1</span>][<span class="number">0</span>] == <span class="string">'-'</span>)&#123;</span><br><span class="line">            <span class="keyword">bool</span> flag = <span class="literal">false</span> ;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; len ; j ++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(argv[<span class="number">1</span>][j] == <span class="string">'a'</span>)</span><br><span class="line">                    is_a = <span class="literal">true</span> ;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(argv[<span class="number">1</span>][j] == <span class="string">'l'</span>)</span><br><span class="line">                    is_l = <span class="literal">true</span> ;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    flag = <span class="literal">true</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Command not found :%s\n"</span>,argv[<span class="number">1</span>]) ;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">memset</span>(pwd,<span class="string">'\0'</span>,BUFFER_SIZE) ;</span><br><span class="line">            <span class="built_in">memcpy</span>(pwd,argv[<span class="number">1</span>],len) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(argc == <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(argv[<span class="number">1</span>]) ;</span><br><span class="line">        <span class="keyword">bool</span> flag = <span class="literal">false</span> ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; len ; j ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(argv[<span class="number">1</span>][j] == <span class="string">'a'</span>)</span><br><span class="line">                is_a = <span class="literal">true</span> ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(argv[<span class="number">1</span>][j] == <span class="string">'l'</span>)</span><br><span class="line">                is_l = <span class="literal">true</span> ;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                flag = <span class="literal">true</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(argv[<span class="number">1</span>][<span class="number">0</span>] != <span class="string">'-'</span> || flag == <span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Command not found :%s\n"</span>,argv[<span class="number">1</span>]) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">memset</span>(pwd,<span class="string">'\0'</span>,BUFFER_SIZE) ;</span><br><span class="line">        <span class="built_in">memcpy</span>(pwd,argv[<span class="number">2</span>],<span class="built_in">strlen</span>(argv[<span class="number">2</span>])) ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,pwd) ;</span><br><span class="line">    </span><br><span class="line">    DIR* dir ;</span><br><span class="line">    dir = opendir(pwd) ;</span><br><span class="line">    dirent* i ;</span><br><span class="line">    <span class="keyword">struct</span> stat st ;</span><br><span class="line">    <span class="keyword">if</span>(stat(pwd,&amp;st) == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"No such File or Dictronary!\n"</span>) ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> file_num = st.st_nlink ;</span><br><span class="line">    name = (<span class="keyword">char</span>(*)[<span class="number">256</span>])<span class="built_in">malloc</span>(file_num*<span class="number">256</span>*<span class="keyword">sizeof</span>(<span class="keyword">char</span>)) ;</span><br><span class="line">    <span class="built_in">memset</span>(name,<span class="number">0</span>,<span class="keyword">sizeof</span> name) ;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">while</span>(i = readdir(dir))&#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(name[cnt],i-&gt;d_name,<span class="built_in">strlen</span>(i-&gt;d_name)) ;</span><br><span class="line">        cnt ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt; cnt ; k ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = k+<span class="number">1</span> ; j &lt; cnt ; j ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(name[k],name[j])&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">char</span> change[<span class="number">256</span>] ;</span><br><span class="line">                <span class="built_in">memset</span>(change,<span class="string">'\0'</span>,<span class="keyword">sizeof</span> change) ;</span><br><span class="line">                <span class="built_in">memcpy</span>(change,name[k],<span class="built_in">strlen</span>(name[k])) ;</span><br><span class="line">                <span class="built_in">memset</span>(name[k],<span class="string">'\0'</span>,<span class="number">256</span>) ;</span><br><span class="line">                <span class="built_in">memcpy</span>(name[k],name[j],<span class="built_in">strlen</span>(name[j])) ;</span><br><span class="line">                <span class="built_in">memset</span>(name[j],<span class="string">'\0'</span>,<span class="number">256</span>) ;</span><br><span class="line">                <span class="built_in">memcpy</span>(name[j],change,<span class="built_in">strlen</span>(change)) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; cnt ; j ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(is_a == <span class="literal">false</span>)</span><br><span class="line">            <span class="keyword">if</span>(name[j][<span class="number">0</span>] == <span class="string">'.'</span>)</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span>(is_l == <span class="literal">false</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,name[j]) ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">struct</span> stat buf ;</span><br><span class="line">            stat(name[j],&amp;buf) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%c%s%s%s"</span>,Type[(buf.st_mode&gt;&gt;<span class="number">12</span>)/<span class="number">2</span>],Mod[(buf.st_mode&gt;&gt;<span class="number">6</span>)&amp;<span class="number">7</span>],Mod[(buf.st_mode&gt;&gt;<span class="number">3</span>)&amp;<span class="number">7</span>],Mod[(buf.st_mode&amp;<span class="number">7</span>)]) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%4d "</span>,buf.st_nlink) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s %s "</span>,getpwuid(buf.st_uid)-&gt;pw_name,getgrgid(buf.st_gid)-&gt;gr_name) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%8d "</span>,buf.st_size) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%.16s  "</span>,ctime(&amp;(buf.st_atime))) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,name[j]) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/29/my-ls-md/" data-id="cj0v033yd000dssn0ebrthyn2" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ipc-shm-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/29/ipc-shm-md/" class="article-date">
  <time datetime="2017-03-29T13:11:42.000Z" itemprop="datePublished">2017-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/29/ipc-shm-md/">ipc_shm.md</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#C语言实现ipc共享内存</p>
<p>##发送端：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span> * argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *sharem = <span class="literal">NULL</span> ;</span><br><span class="line">    <span class="keyword">key_t</span> key ;</span><br><span class="line">    key = ftok(<span class="string">"."</span>,<span class="number">123</span>) ;</span><br><span class="line">    <span class="keyword">int</span> shid ;</span><br><span class="line">    shid = shmget(key,(<span class="keyword">size_t</span>)<span class="number">2048</span>,IPC_CREAT|<span class="number">0600</span>) ;</span><br><span class="line">    sharem = shmat(shid,<span class="literal">NULL</span>,<span class="number">0</span>) ;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Input messages :\n"</span>) ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,sharem) ;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(((<span class="keyword">char</span>*)sharem),<span class="string">"end"</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">            shmdt(sharem) ;</span><br><span class="line">            <span class="keyword">break</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##接收端：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span> * argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *sharem = <span class="literal">NULL</span> ;</span><br><span class="line">    <span class="keyword">char</span> last[<span class="number">2048</span>] = <span class="string">"_"</span> ;</span><br><span class="line">    <span class="keyword">key_t</span> key ;</span><br><span class="line">    key = ftok(<span class="string">"."</span>,<span class="number">123</span>) ;</span><br><span class="line">    <span class="keyword">int</span> shid ;</span><br><span class="line">    shid = shmget(key,(<span class="keyword">size_t</span>)<span class="number">2048</span>,IPC_CREAT|<span class="number">0600</span>) ;</span><br><span class="line">    sharem = (<span class="keyword">char</span>*)shmat(shid,<span class="literal">NULL</span>,<span class="number">0</span>) ;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(sharem,last)!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,sharem) ;</span><br><span class="line">            <span class="built_in">memset</span>(last,<span class="string">'\0'</span>,<span class="keyword">sizeof</span> last) ;</span><br><span class="line">            <span class="built_in">memcpy</span>(last,sharem,<span class="built_in">strlen</span>(sharem)) ;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(sharem,<span class="string">"end"</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                shmdt(sharem) ;</span><br><span class="line">                <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sleep(<span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    shmctl(shid,IPC_RMID,<span class="number">0</span>) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/29/ipc-shm-md/" data-id="cj0v033yb000cssn01ttuq3g4" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ipc-sem-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/29/ipc-sem-md/" class="article-date">
  <time datetime="2017-03-29T13:11:36.000Z" itemprop="datePublished">2017-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/29/ipc-sem-md/">ipc_sem.md</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#C语言实现ipc信号量</p>
<p>##发送端<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Num 5</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span> * argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>)) ;</span><br><span class="line">    <span class="keyword">key_t</span> key ;</span><br><span class="line">    key = ftok(<span class="string">"."</span>,<span class="number">123</span>) ;</span><br><span class="line">    <span class="keyword">int</span> sem_id ;</span><br><span class="line">    sem_id = semget(key,Num,IPC_CREAT|<span class="number">0664</span>) ;</span><br><span class="line">    <span class="keyword">union</span> semun&#123;</span><br><span class="line">        <span class="keyword">int</span> val ;</span><br><span class="line">        <span class="keyword">struct</span> semid_ds *buf ;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">short</span> *<span class="built_in">array</span> ;</span><br><span class="line">    &#125; arg ;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> arr[Num] ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"There is %d sems :"</span>,Num) ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; Num ; i ++)&#123;</span><br><span class="line">        arr[i] = rand()%<span class="number">10</span> ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>,arr[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>) ;</span><br><span class="line">    arg.<span class="built_in">array</span> = &amp;arr[<span class="number">0</span>] ;</span><br><span class="line">    semctl(sem_id,<span class="number">0</span>,SETALL,arg) ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i ++)&#123;</span><br><span class="line">        sleep(<span class="number">3</span>) ;</span><br><span class="line">        <span class="keyword">struct</span> sembuf buf ;</span><br><span class="line">        <span class="keyword">short</span> t , val ;</span><br><span class="line">        t = (<span class="keyword">short</span>)(rand()%Num) ;</span><br><span class="line">        val = (<span class="keyword">short</span>)(rand()%<span class="number">20</span> + <span class="number">1</span>) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Add the %dth sem by %d\n"</span>,t,val) ;</span><br><span class="line">        buf.sem_num = t ;</span><br><span class="line">        buf.sem_op = val ;</span><br><span class="line">        buf.sem_flg = <span class="number">0</span> ;</span><br><span class="line">        semop(sem_id,&amp;buf,<span class="number">1</span>) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##接收端<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Num 5</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">key_t</span> key ;</span><br><span class="line">    key = ftok(<span class="string">"."</span>,<span class="number">123</span>) ;</span><br><span class="line">    <span class="keyword">int</span> sem_id ;</span><br><span class="line">    sem_id = semget(key,Num,IPC_CREAT|<span class="number">0664</span>) ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">11</span> ; i ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; Num ; j ++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>,semctl(sem_id,j,GETVAL)) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n\n"</span>) ;</span><br><span class="line">        sleep(<span class="number">3</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/29/ipc-sem-md/" data-id="cj0v033ya000bssn0bhxri6h6" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ipc-msg-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/29/ipc-msg-md/" class="article-date">
  <time datetime="2017-03-29T13:11:03.000Z" itemprop="datePublished">2017-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/29/ipc-msg-md/">ipc_msg</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#C语言实现ipc消息队列</p>
<p>##发送端：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> msgbuf&#123;</span><br><span class="line">    <span class="keyword">long</span> mtype ;</span><br><span class="line">    <span class="keyword">char</span> mtext[<span class="number">1024</span>] ;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span>* argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid ;</span><br><span class="line">    <span class="keyword">key_t</span> key ;</span><br><span class="line">    key = ftok(<span class="string">"."</span>,<span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">int</span> msgid ;</span><br><span class="line">    msgid = msgget(key,IPC_CREAT|<span class="number">0600</span>) ;</span><br><span class="line">    pid = fork() ;</span><br><span class="line">    <span class="keyword">if</span>(pid == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Please input message:\n"</span>) ;</span><br><span class="line">            <span class="keyword">char</span> message[<span class="number">1024</span>] ;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,message) ;</span><br><span class="line">            msgbuf ptr  ;</span><br><span class="line">            ptr.mtype = <span class="number">1</span> ;</span><br><span class="line">            <span class="built_in">memcpy</span>(ptr.mtext,message,<span class="built_in">strlen</span>(message)+<span class="number">1</span>) ;</span><br><span class="line">            msgsnd(msgid,&amp;ptr,<span class="built_in">strlen</span>(message)+<span class="number">1</span>,<span class="number">0</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            msgbuf rec ;</span><br><span class="line">            <span class="built_in">memset</span>(rec.mtext,<span class="string">'\0'</span>,<span class="keyword">sizeof</span> rec.mtext) ;</span><br><span class="line">            msgrcv(msgid,&amp;rec,<span class="number">1024</span>,<span class="number">2</span>,<span class="number">0</span>) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"messege recived : %s\n"</span>,rec.mtext) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##接收端:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> msgbuf&#123;</span><br><span class="line">    <span class="keyword">long</span> mtype ;</span><br><span class="line">    <span class="keyword">char</span> mtext[<span class="number">1024</span>] ;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span>* argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid ;</span><br><span class="line">    <span class="keyword">key_t</span> key ;</span><br><span class="line">    key = ftok(<span class="string">"."</span>,<span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">int</span> msgid ;</span><br><span class="line">    msgid = msgget(key,IPC_CREAT|<span class="number">0600</span>) ;</span><br><span class="line">    pid = fork() ;</span><br><span class="line">    <span class="keyword">if</span>(pid == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Please input message:\n"</span>) ;</span><br><span class="line">            <span class="keyword">char</span> message[<span class="number">1024</span>] ;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,message) ;</span><br><span class="line">            msgbuf ptr  ;</span><br><span class="line">            ptr.mtype = <span class="number">2</span> ;</span><br><span class="line">            <span class="built_in">memcpy</span>(ptr.mtext,message,<span class="built_in">strlen</span>(message)+<span class="number">1</span>) ;</span><br><span class="line">            msgsnd(msgid,&amp;ptr,<span class="built_in">strlen</span>(message)+<span class="number">1</span>,<span class="number">0</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            msgbuf rec ;</span><br><span class="line">            <span class="built_in">memset</span>(rec.mtext,<span class="string">'\0'</span>,<span class="keyword">sizeof</span> rec.mtext) ;</span><br><span class="line">            msgrcv(msgid,&amp;rec,<span class="number">1024</span>,<span class="number">1</span>,<span class="number">0</span>) ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"messege recived : %s\n"</span>,rec.mtext) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/29/ipc-msg-md/" data-id="cj0v033y8000assn08ce96w83" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-HUSTOJ-Judge-Client" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/18/HUSTOJ-Judge-Client/" class="article-date">
  <time datetime="2017-03-18T07:36:57.000Z" itemprop="datePublished">2017-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/18/HUSTOJ-Judge-Client/">HUSTOJ_Judge_Client</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HUSTOJ-core"><a href="#HUSTOJ-core" class="headerlink" title="HUSTOJ core"></a>HUSTOJ core</h1><p>Judge_client</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">#define IGNORE_ESOL</span><br><span class="line">// File:   main.cc</span><br><span class="line">// Author: sempr</span><br><span class="line">// refacted by zhblue</span><br><span class="line">/*</span><br><span class="line"> * Copyright 2008 sempr &lt;iamsempr@gmail.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * Refacted and modified by zhblue&lt;newsclan@gmail.com&gt;</span><br><span class="line"> * Bug report email newsclan@gmail.com</span><br><span class="line"> *</span><br><span class="line"> *</span><br><span class="line"> * This file is part of HUSTOJ.</span><br><span class="line"> *</span><br><span class="line"> * HUSTOJ is free software; you can redistribute it and/or modify</span><br><span class="line"> * it under the terms of the GNU General Public License as published by</span><br><span class="line"> * the Free Software Foundation; either version 2 of the License, or</span><br><span class="line"> * (at your option) any later version.</span><br><span class="line"> *</span><br><span class="line"> * HUSTOJ is distributed in the hope that it will be useful,</span><br><span class="line"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"> * GNU General Public License for more details.</span><br><span class="line"> *</span><br><span class="line"> * You should have received a copy of the GNU General Public License</span><br><span class="line"> * along with HUSTOJ. if not, see &lt;http://www.gnu.org/licenses/&gt;.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;dirent.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line">#include &lt;stdarg.h&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;sys/ptrace.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/user.h&gt;</span><br><span class="line">#include &lt;sys/syscall.h&gt;</span><br><span class="line">#include &lt;sys/time.h&gt;</span><br><span class="line">#include &lt;sys/resource.h&gt;</span><br><span class="line">#include &lt;sys/signal.h&gt;</span><br><span class="line">//#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;mysql/mysql.h&gt;</span><br><span class="line">#include &lt;assert.h&gt;</span><br><span class="line">#include "okcalls.h"</span><br><span class="line"></span><br><span class="line">#define STD_MB 1048576</span><br><span class="line">#define STD_T_LIM 2</span><br><span class="line">#define STD_F_LIM (STD_MB&lt;&lt;5)</span><br><span class="line">#define STD_M_LIM (STD_MB&lt;&lt;7)</span><br><span class="line">#define BUFFER_SIZE 5120</span><br><span class="line"></span><br><span class="line">#define OJ_WT0 0</span><br><span class="line">#define OJ_WT1 1</span><br><span class="line">#define OJ_CI 2</span><br><span class="line">#define OJ_RI 3</span><br><span class="line">#define OJ_AC 4</span><br><span class="line">#define OJ_PE 5</span><br><span class="line">#define OJ_WA 6</span><br><span class="line">#define OJ_TL 7</span><br><span class="line">#define OJ_ML 8</span><br><span class="line">#define OJ_OL 9</span><br><span class="line">#define OJ_RE 10</span><br><span class="line">#define OJ_CE 11</span><br><span class="line">#define OJ_CO 12</span><br><span class="line">#define OJ_TR 13</span><br><span class="line">/*copy from ZOJ</span><br><span class="line"> http://code.google.com/p/zoj/source/browse/trunk/judge_client/client/tracer.cc?spec=svn367&amp;r=367#39</span><br><span class="line"> */</span><br><span class="line">#ifdef __i386</span><br><span class="line">#define REG_SYSCALL orig_eax</span><br><span class="line">#define REG_RET eax</span><br><span class="line">#define REG_ARG0 ebx</span><br><span class="line">#define REG_ARG1 ecx</span><br><span class="line">#else</span><br><span class="line">#define REG_SYSCALL orig_rax</span><br><span class="line">#define REG_RET rax</span><br><span class="line">#define REG_ARG0 rdi</span><br><span class="line">#define REG_ARG1 rsi</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">static int DEBUG = 0;</span><br><span class="line">static char host_name[BUFFER_SIZE];</span><br><span class="line">static char user_name[BUFFER_SIZE];</span><br><span class="line">static char password[BUFFER_SIZE];</span><br><span class="line">static char db_name[BUFFER_SIZE];</span><br><span class="line">static char oj_home[BUFFER_SIZE];</span><br><span class="line">static char data_list[BUFFER_SIZE][BUFFER_SIZE];</span><br><span class="line">static int data_list_len=0;</span><br><span class="line"></span><br><span class="line">static int port_number;</span><br><span class="line">static int max_running;</span><br><span class="line">static int sleep_time;</span><br><span class="line">static int java_time_bonus = 5;</span><br><span class="line">static int java_memory_bonus = 512;</span><br><span class="line">static char java_xms[BUFFER_SIZE];</span><br><span class="line">static char java_xmx[BUFFER_SIZE];</span><br><span class="line">static int sim_enable = 0;</span><br><span class="line">static int oi_mode = 0;</span><br><span class="line">static int full_diff = 0;</span><br><span class="line">static int use_max_time = 0;</span><br><span class="line"></span><br><span class="line">static int http_judge = 0;</span><br><span class="line">static char http_baseurl[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">static char http_username[BUFFER_SIZE];</span><br><span class="line">static char http_password[BUFFER_SIZE];</span><br><span class="line">static int shm_run = 0;</span><br><span class="line"></span><br><span class="line">static char record_call = 0;</span><br><span class="line">static int use_ptrace = 1;</span><br><span class="line"></span><br><span class="line">//static int sleep_tmp;</span><br><span class="line">#define ZOJ_COM</span><br><span class="line">MYSQL *conn;</span><br><span class="line"></span><br><span class="line">static char lang_ext[18][8] = &#123; "c", "cc", "pas", "java", "rb", "sh", "py",</span><br><span class="line">		"php", "pl", "cs", "m", "bas", "scm","c","cc","lua","js","go" &#125;;</span><br><span class="line">//static char buf[BUFFER_SIZE];</span><br><span class="line">int data_list_has(char * file)&#123;</span><br><span class="line">   for(int i=0;i&lt;data_list_len;i++)&#123;</span><br><span class="line">       if(strcmp(data_list[i],file)==0)</span><br><span class="line">		return 1;</span><br><span class="line">   &#125;</span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br><span class="line">int data_list_add(char * file)&#123;</span><br><span class="line">   if(data_list_len&lt;BUFFER_SIZE-1)&#123;</span><br><span class="line">	strcpy(data_list[data_list_len],file);</span><br><span class="line">	data_list_len++;</span><br><span class="line">   	return 0;</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">	return 1;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">long get_file_size(const char * filename) &#123;</span><br><span class="line">	struct stat f_stat;</span><br><span class="line"></span><br><span class="line">	if (stat(filename, &amp;f_stat) == -1) &#123;</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return (long) f_stat.st_size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void write_log(const char *fmt, ...) &#123;</span><br><span class="line">	va_list ap;</span><br><span class="line">	char buffer[4096];</span><br><span class="line">	//      time_t          t = time(NULL);</span><br><span class="line">	//int l;</span><br><span class="line">	sprintf(buffer, "%s/log/client.log", oj_home);</span><br><span class="line">	FILE *fp = fopen(buffer, "ae+");</span><br><span class="line">	if (fp == NULL) &#123;</span><br><span class="line">		fprintf(stderr, "openfile error!\n");</span><br><span class="line">		system("pwd");</span><br><span class="line">	&#125;</span><br><span class="line">	va_start(ap, fmt);</span><br><span class="line">	//l = </span><br><span class="line">	vsprintf(buffer, fmt, ap);</span><br><span class="line">	fprintf(fp, "%s\n", buffer);</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("%s\n", buffer);</span><br><span class="line">	va_end(ap);</span><br><span class="line">	fclose(fp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">int execute_cmd(const char * fmt, ...) &#123;</span><br><span class="line">	char cmd[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">	int ret = 0;</span><br><span class="line">	va_list ap;</span><br><span class="line"></span><br><span class="line">	va_start(ap, fmt);</span><br><span class="line">	vsprintf(cmd, fmt, ap);</span><br><span class="line">	ret = system(cmd);</span><br><span class="line">	va_end(ap);</span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const int call_array_size = 512;</span><br><span class="line">int call_counter[call_array_size] = &#123; 0 &#125;;</span><br><span class="line">static char LANG_NAME[BUFFER_SIZE];</span><br><span class="line">void init_syscalls_limits(int lang) &#123;</span><br><span class="line">	int i;</span><br><span class="line">	memset(call_counter, 0, sizeof(call_counter));</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		write_log("init_call_counter:%d", lang);</span><br><span class="line">	if (record_call) &#123; // C &amp; C++</span><br><span class="line">		for (i = 0; i &lt; call_array_size; i++) &#123;</span><br><span class="line">			call_counter[i] = 0;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else if (lang &lt;= 1||lang==13||lang==14) &#123; // C &amp; C++</span><br><span class="line">		for (i = 0; i==0||LANG_CV[i]; i++) &#123;</span><br><span class="line">			call_counter[LANG_CV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else if (lang == 2) &#123; // Pascal</span><br><span class="line">		for (i = 0; i==0||LANG_PV[i]; i++)</span><br><span class="line">			call_counter[LANG_PV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 3) &#123; // Java</span><br><span class="line">		for (i = 0; i==0||LANG_JV[i]; i++)</span><br><span class="line">			call_counter[LANG_JV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 4) &#123; // Ruby</span><br><span class="line">		for (i = 0; i==0||LANG_RV[i]; i++)</span><br><span class="line">			call_counter[LANG_RV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 5) &#123; // Bash</span><br><span class="line">		for (i = 0; i==0||LANG_BV[i]; i++)</span><br><span class="line">			call_counter[LANG_BV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 6) &#123; // Python</span><br><span class="line">		for (i = 0; i==0||LANG_YV[i]; i++)</span><br><span class="line">			call_counter[LANG_YV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 7) &#123; // php</span><br><span class="line">		for (i = 0; i==0||LANG_PHV[i]; i++)</span><br><span class="line">			call_counter[LANG_PHV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 8) &#123; // perl</span><br><span class="line">		for (i = 0; i==0||LANG_PLV[i]; i++)</span><br><span class="line">			call_counter[LANG_PLV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 9) &#123; // mono c#</span><br><span class="line">		for (i = 0; i==0||LANG_CSV[i]; i++)</span><br><span class="line">			call_counter[LANG_CSV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 10) &#123; //objective c</span><br><span class="line">		for (i = 0; i==0||LANG_OV[i]; i++)</span><br><span class="line">			call_counter[LANG_OV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 11) &#123; //free basic</span><br><span class="line">		for (i = 0; i==0||LANG_BASICV[i]; i++)</span><br><span class="line">			call_counter[LANG_BASICV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 12) &#123; //scheme guile</span><br><span class="line">		for (i = 0; i==0||LANG_SV[i]; i++)</span><br><span class="line">			call_counter[LANG_SV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 15) &#123; //lua</span><br><span class="line">		for (i = 0; i==0||LANG_LUAV[i]; i++)</span><br><span class="line">			call_counter[LANG_LUAV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 16) &#123; //nodejs</span><br><span class="line">		for (i = 0; i==0||LANG_JSV[i]; i++)</span><br><span class="line">			call_counter[LANG_JSV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125; else if (lang == 17) &#123; //go</span><br><span class="line">		for (i = 0; i==0||LANG_GOV[i]; i++)</span><br><span class="line">			call_counter[LANG_GOV[i]] = HOJ_MAX_LIMIT;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int after_equal(char * c) &#123;</span><br><span class="line">	int i = 0;</span><br><span class="line">	for (; c[i] != '\0' &amp;&amp; c[i] != '='; i++)</span><br><span class="line">		;</span><br><span class="line">	return ++i;</span><br><span class="line">&#125;</span><br><span class="line">void trim(char * c) &#123;</span><br><span class="line">	char buf[BUFFER_SIZE];</span><br><span class="line">	char * start, *end;</span><br><span class="line">	strcpy(buf, c);</span><br><span class="line">	start = buf;</span><br><span class="line">	while (isspace(*start))</span><br><span class="line">		start++;</span><br><span class="line">	end = start;</span><br><span class="line">	while (!isspace(*end))</span><br><span class="line">		end++;</span><br><span class="line">	*end = '\0';</span><br><span class="line">	strcpy(c, start);</span><br><span class="line">&#125;</span><br><span class="line">bool read_buf(char * buf, const char * key, char * value) &#123;</span><br><span class="line">	if (strncmp(buf, key, strlen(key)) == 0) &#123;</span><br><span class="line">		strcpy(value, buf + after_equal(buf));</span><br><span class="line">		trim(value);</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("%s\n", value);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">void read_int(char * buf, const char * key, int * value) &#123;</span><br><span class="line">	char buf2[BUFFER_SIZE];</span><br><span class="line">	if (read_buf(buf, key, buf2))</span><br><span class="line">		sscanf(buf2, "%d", value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// read the configue file</span><br><span class="line">void init_mysql_conf() &#123;</span><br><span class="line">	FILE *fp = NULL;</span><br><span class="line">	char buf[BUFFER_SIZE];</span><br><span class="line">	host_name[0] = 0;</span><br><span class="line">	user_name[0] = 0;</span><br><span class="line">	password[0] = 0;</span><br><span class="line">	db_name[0] = 0;</span><br><span class="line">	port_number = 3306;</span><br><span class="line">	max_running = 3;</span><br><span class="line">	sleep_time = 3;</span><br><span class="line">	strcpy(java_xms, "-Xms32m");</span><br><span class="line">	strcpy(java_xmx, "-Xmx256m");</span><br><span class="line">	sprintf(buf, "%s/etc/judge.conf", oj_home);</span><br><span class="line">	fp = fopen("./etc/judge.conf", "re");</span><br><span class="line">	if (fp != NULL) &#123;</span><br><span class="line">		while (fgets(buf, BUFFER_SIZE - 1, fp)) &#123;</span><br><span class="line">			read_buf(buf, "OJ_HOST_NAME", host_name);</span><br><span class="line">			read_buf(buf, "OJ_USER_NAME", user_name);</span><br><span class="line">			read_buf(buf, "OJ_PASSWORD", password);</span><br><span class="line">			read_buf(buf, "OJ_DB_NAME", db_name);</span><br><span class="line">			read_int(buf, "OJ_PORT_NUMBER", &amp;port_number);</span><br><span class="line">			read_int(buf, "OJ_JAVA_TIME_BONUS", &amp;java_time_bonus);</span><br><span class="line">			read_int(buf, "OJ_JAVA_MEMORY_BONUS", &amp;java_memory_bonus);</span><br><span class="line">			read_int(buf, "OJ_SIM_ENABLE", &amp;sim_enable);</span><br><span class="line">			read_buf(buf, "OJ_JAVA_XMS", java_xms);</span><br><span class="line">			read_buf(buf, "OJ_JAVA_XMX", java_xmx);</span><br><span class="line">			read_int(buf, "OJ_HTTP_JUDGE", &amp;http_judge);</span><br><span class="line">			read_buf(buf, "OJ_HTTP_BASEURL", http_baseurl);</span><br><span class="line">			read_buf(buf, "OJ_HTTP_USERNAME", http_username);</span><br><span class="line">			read_buf(buf, "OJ_HTTP_PASSWORD", http_password);</span><br><span class="line">			read_int(buf, "OJ_OI_MODE", &amp;oi_mode);</span><br><span class="line">			read_int(buf, "OJ_FULL_DIFF", &amp;full_diff);</span><br><span class="line">			read_int(buf, "OJ_SHM_RUN", &amp;shm_run);</span><br><span class="line">			read_int(buf, "OJ_USE_MAX_TIME", &amp;use_max_time);</span><br><span class="line">			read_int(buf, "OJ_USE_PTRACE", &amp;use_ptrace);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		//fclose(fp);</span><br><span class="line">	&#125;</span><br><span class="line">//	fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int isInFile(const char fname[]) &#123;</span><br><span class="line">	int l = strlen(fname);</span><br><span class="line">	if (l &lt;= 3 || strcmp(fname + l - 3, ".in") != 0)</span><br><span class="line">		return 0;</span><br><span class="line">	else</span><br><span class="line">		return l - 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void find_next_nonspace(int &amp; c1, int &amp; c2, FILE *&amp; f1, FILE *&amp; f2, int &amp; ret) &#123;</span><br><span class="line">	// Find the next non-space character or \n.</span><br><span class="line">	while ((isspace(c1)) || (isspace(c2))) &#123;</span><br><span class="line">		if (c1 != c2) &#123;</span><br><span class="line">			if (c2 == EOF) &#123;</span><br><span class="line">				do &#123;</span><br><span class="line">					c1 = fgetc(f1);</span><br><span class="line">				&#125; while (isspace(c1));</span><br><span class="line">				continue;</span><br><span class="line">			&#125; else if (c1 == EOF) &#123;</span><br><span class="line">				do &#123;</span><br><span class="line">					c2 = fgetc(f2);</span><br><span class="line">				&#125; while (isspace(c2));</span><br><span class="line">				continue;</span><br><span class="line">#ifdef IGNORE_ESOL</span><br><span class="line">			&#125; else if (isspace(c1) &amp;&amp; isspace(c2)) &#123;</span><br><span class="line">                                  while(c2=='\n'&amp;&amp;isspace(c1)&amp;&amp;c1!='\n') c1 = fgetc(f1);</span><br><span class="line">                                  while(c1=='\n'&amp;&amp;isspace(c2)&amp;&amp;c2!='\n') c2 = fgetc(f2);</span><br><span class="line">	</span><br><span class="line">#else</span><br><span class="line">			&#125; else if ((c1 == '\r' &amp;&amp; c2 == '\n')) &#123;</span><br><span class="line">				c1 = fgetc(f1);</span><br><span class="line">			&#125; else if ((c2 == '\r' &amp;&amp; c1 == '\n')) &#123;</span><br><span class="line">				c2 = fgetc(f2);			</span><br><span class="line">#endif</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				if (DEBUG)</span><br><span class="line">					printf("%d=%c\t%d=%c", c1, c1, c2, c2);</span><br><span class="line">				;</span><br><span class="line">				ret = OJ_PE;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		if (isspace(c1)) &#123;</span><br><span class="line">			c1 = fgetc(f1);</span><br><span class="line">		&#125;</span><br><span class="line">		if (isspace(c2)) &#123;</span><br><span class="line">			c2 = fgetc(f2);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/***</span><br><span class="line"> int compare_diff(const char *file1,const char *file2)&#123;</span><br><span class="line"> char diff[1024];</span><br><span class="line"> sprintf(diff,"diff -q -B -b -w --strip-trailing-cr %s %s",file1,file2);</span><br><span class="line"> int d=system(diff);</span><br><span class="line"> if (d) return OJ_WA;</span><br><span class="line"> sprintf(diff,"diff -q -B --strip-trailing-cr %s %s",file1,file2);</span><br><span class="line"> int p=system(diff);</span><br><span class="line"> if (p) return OJ_PE;</span><br><span class="line"> else return OJ_AC;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"> */</span><br><span class="line">const char * getFileNameFromPath(const char * path) &#123;</span><br><span class="line">	for (int i = strlen(path); i &gt;= 0; i--) &#123;</span><br><span class="line">		if (path[i] == '/')</span><br><span class="line">			return &amp;path[i+1];</span><br><span class="line">	&#125;</span><br><span class="line">	return path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void make_diff_out_full(FILE *f1, FILE *f2, int c1, int c2, const char * path) &#123;</span><br><span class="line">	</span><br><span class="line">	execute_cmd("echo '========[%s]========='&gt;&gt;diff.out",getFileNameFromPath(path));</span><br><span class="line">	execute_cmd("echo '------test in top 100 lines------'&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("head -100 data.in&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("echo '------test out top 100 lines-----'&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("head -100 '%s'&gt;&gt;diff.out",path);</span><br><span class="line">	execute_cmd("echo '------user out top 100 lines-----'&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("head -100 user.out&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("echo '------diff out 200 lines-----'&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("diff '%s' user.out|head -200&gt;&gt;diff.out",path);</span><br><span class="line">	execute_cmd("echo '=============================='&gt;&gt;diff.out");</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void make_diff_out_simple(FILE *f1, FILE *f2, int c1, int c2, const char * path) &#123;</span><br><span class="line">	execute_cmd("echo '========[%s]========='&gt;&gt;diff.out",getFileNameFromPath(path));</span><br><span class="line">	execute_cmd("echo '=======diff out 100 lines====='&gt;&gt;diff.out");</span><br><span class="line">	execute_cmd("diff '%s' user.out|head -100&gt;&gt;diff.out",path);</span><br><span class="line">	execute_cmd("echo '=============================='&gt;&gt;diff.out");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * translated from ZOJ judger r367</span><br><span class="line"> * http://code.google.com/p/zoj/source/browse/trunk/judge_client/client/text_checker.cc#25</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">int compare_zoj(const char *file1, const char *file2) &#123;</span><br><span class="line">	int ret = OJ_AC;</span><br><span class="line">	int c1, c2;</span><br><span class="line">	FILE * f1, *f2;</span><br><span class="line">	f1 = fopen(file1, "re");</span><br><span class="line">	f2 = fopen(file2, "re");</span><br><span class="line">	if (!f1 || !f2) &#123;</span><br><span class="line">		ret = OJ_RE;</span><br><span class="line">	&#125; else</span><br><span class="line">		for (;;) &#123;</span><br><span class="line">			// Find the first non-space character at the beginning of line.</span><br><span class="line">			// Blank lines are skipped.</span><br><span class="line">			c1 = fgetc(f1);</span><br><span class="line">			c2 = fgetc(f2);</span><br><span class="line">			find_next_nonspace(c1, c2, f1, f2, ret);</span><br><span class="line">			// Compare the current line.</span><br><span class="line">			for (;;) &#123;</span><br><span class="line">				// Read until 2 files return a space or 0 together.</span><br><span class="line">				while ((!isspace(c1) &amp;&amp; c1) || (!isspace(c2) &amp;&amp; c2)) &#123;</span><br><span class="line">					if (c1 == EOF &amp;&amp; c2 == EOF) &#123;</span><br><span class="line">						goto end;</span><br><span class="line">					&#125;</span><br><span class="line">					if (c1 == EOF || c2 == EOF) &#123;</span><br><span class="line">						break;</span><br><span class="line">					&#125;</span><br><span class="line">					if (c1 != c2) &#123;</span><br><span class="line">						// Consecutive non-space characters should be all exactly the same</span><br><span class="line">						ret = OJ_WA;</span><br><span class="line">						goto end;</span><br><span class="line">					&#125;</span><br><span class="line">					c1 = fgetc(f1);</span><br><span class="line">					c2 = fgetc(f2);</span><br><span class="line">				&#125;</span><br><span class="line">				find_next_nonspace(c1, c2, f1, f2, ret);</span><br><span class="line">				if (c1 == EOF &amp;&amp; c2 == EOF) &#123;</span><br><span class="line">					goto end;</span><br><span class="line">				&#125;</span><br><span class="line">				if (c1 == EOF || c2 == EOF) &#123;</span><br><span class="line">					ret = OJ_WA;</span><br><span class="line">					goto end;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				if ((c1 == '\n' || !c1) &amp;&amp; (c2 == '\n' || !c2)) &#123;</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	end: </span><br><span class="line">	if (ret == OJ_WA||ret==OJ_PE)&#123;</span><br><span class="line">		if(full_diff)</span><br><span class="line">			make_diff_out_full(f1, f2, c1, c2, file1);</span><br><span class="line">		else</span><br><span class="line">			make_diff_out_simple(f1, f2, c1, c2, file1);</span><br><span class="line">	&#125;</span><br><span class="line">	if (f1)</span><br><span class="line">		fclose(f1);</span><br><span class="line">	if (f2)</span><br><span class="line">		fclose(f2);</span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void delnextline(char s[]) &#123;</span><br><span class="line">	int L;</span><br><span class="line">	L = strlen(s);</span><br><span class="line">	while (L &gt; 0 &amp;&amp; (s[L - 1] == '\n' || s[L - 1] == '\r'))</span><br><span class="line">		s[--L] = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int compare(const char *file1, const char *file2) &#123;</span><br><span class="line">#ifdef ZOJ_COM</span><br><span class="line">	//compare ported and improved from zoj don't limit file size</span><br><span class="line">	return compare_zoj(file1, file2);</span><br><span class="line">#endif</span><br><span class="line">#ifndef ZOJ_COM</span><br><span class="line">	//the original compare from the first version of hustoj has file size limit</span><br><span class="line">	//and waste memory</span><br><span class="line">	FILE *f1,*f2;</span><br><span class="line">	char *s1,*s2,*p1,*p2;</span><br><span class="line">	int PEflg;</span><br><span class="line">	s1=new char[STD_F_LIM+512];</span><br><span class="line">	s2=new char[STD_F_LIM+512];</span><br><span class="line">	if (!(f1=fopen(file1,"re")))</span><br><span class="line">	return OJ_AC;</span><br><span class="line">	for (p1=s1;EOF!=fscanf(f1,"%s",p1);)</span><br><span class="line">	while (*p1) p1++;</span><br><span class="line">	fclose(f1);</span><br><span class="line">	if (!(f2=fopen(file2,"re")))</span><br><span class="line">	return OJ_RE;</span><br><span class="line">	for (p2=s2;EOF!=fscanf(f2,"%s",p2);)</span><br><span class="line">	while (*p2) p2++;</span><br><span class="line">	fclose(f2);</span><br><span class="line">	if (strcmp(s1,s2)!=0) &#123;</span><br><span class="line">		//              printf("A:%s\nB:%s\n",s1,s2);</span><br><span class="line">		delete[] s1;</span><br><span class="line">		delete[] s2;</span><br><span class="line"></span><br><span class="line">		return OJ_WA;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		f1=fopen(file1,"re");</span><br><span class="line">		f2=fopen(file2,"re");</span><br><span class="line">		PEflg=0;</span><br><span class="line">		while (PEflg==0 &amp;&amp; fgets(s1,STD_F_LIM,f1) &amp;&amp; fgets(s2,STD_F_LIM,f2)) &#123;</span><br><span class="line">			delnextline(s1);</span><br><span class="line">			delnextline(s2);</span><br><span class="line">			if (strcmp(s1,s2)==0) continue;</span><br><span class="line">			else PEflg=1;</span><br><span class="line">		&#125;</span><br><span class="line">		delete [] s1;</span><br><span class="line">		delete [] s2;</span><br><span class="line">		fclose(f1);fclose(f2);</span><br><span class="line">		if (PEflg) return OJ_PE;</span><br><span class="line">		else return OJ_AC;</span><br><span class="line">	&#125;</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FILE * read_cmd_output(const char * fmt, ...) &#123;</span><br><span class="line">	char cmd[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">	FILE * ret = NULL;</span><br><span class="line">	va_list ap;</span><br><span class="line"></span><br><span class="line">	va_start(ap, fmt);</span><br><span class="line">	vsprintf(cmd, fmt, ap);</span><br><span class="line">	va_end(ap);</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("%s\n", cmd);</span><br><span class="line">	ret = popen(cmd, "r");</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">bool check_login() &#123;</span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-data=\"checklogin=1\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	int ret = 0;</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, http_baseurl);</span><br><span class="line">	fscanf(fjobs, "%d", &amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">void login() &#123;</span><br><span class="line">	if (!check_login()) &#123;</span><br><span class="line">		const char * cmd =</span><br><span class="line">				"wget --post-data=\"user_id=%s&amp;password=%s\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/login.php\"";</span><br><span class="line">		FILE * fjobs = read_cmd_output(cmd, http_username, http_password,</span><br><span class="line">				http_baseurl);</span><br><span class="line">		//fscanf(fjobs,"%d",&amp;ret);</span><br><span class="line">		pclose(fjobs);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/* write result back to database */</span><br><span class="line">void _update_solution_mysql(int solution_id, int result, int time, int memory,</span><br><span class="line">		int sim, int sim_s_id, double pass_rate) &#123;</span><br><span class="line">	char sql[BUFFER_SIZE];</span><br><span class="line">	if (oi_mode) &#123;</span><br><span class="line">		sprintf(sql,</span><br><span class="line">				"UPDATE solution SET result=%d,time=%d,memory=%d,pass_rate=%f,judger='%s' WHERE solution_id=%d LIMIT 1%c",</span><br><span class="line">				result, time, memory, pass_rate,http_username, solution_id, 0);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		sprintf(sql,</span><br><span class="line">				"UPDATE solution SET result=%d,time=%d,memory=%d,judger='%s' WHERE solution_id=%d LIMIT 1%c",</span><br><span class="line">				result, time, memory,http_username, solution_id, 0);</span><br><span class="line">	&#125;</span><br><span class="line">	//      printf("sql= %s\n",sql);</span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql))) &#123;</span><br><span class="line">		//              printf("..update failed! %s\n",mysql_error(conn));</span><br><span class="line">	&#125;</span><br><span class="line">	if (sim) &#123;</span><br><span class="line">		sprintf(sql,</span><br><span class="line">				"insert into sim(s_id,sim_s_id,sim) values(%d,%d,%d) on duplicate key update  sim_s_id=%d,sim=%d",</span><br><span class="line">				solution_id, sim_s_id, sim, sim_s_id, sim);</span><br><span class="line">		//      printf("sql= %s\n",sql);</span><br><span class="line">		if (mysql_real_query(conn, sql, strlen(sql))) &#123;</span><br><span class="line">			//              printf("..update failed! %s\n",mysql_error(conn));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void _update_solution_http(int solution_id, int result, int time, int memory,</span><br><span class="line">		int sim, int sim_s_id, double pass_rate) &#123;</span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-data=\"update_solution=1&amp;sid=%d&amp;result=%d&amp;time=%d&amp;memory=%d&amp;sim=%d&amp;simid=%d&amp;pass_rate=%f\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, solution_id, result, time, memory, sim,</span><br><span class="line">			sim_s_id, pass_rate, http_baseurl);</span><br><span class="line">	//fscanf(fjobs,"%d",&amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line">&#125;</span><br><span class="line">void update_solution(int solution_id, int result, int time, int memory, int sim,</span><br><span class="line">		int sim_s_id, double pass_rate) &#123;</span><br><span class="line">	if (result == OJ_TL &amp;&amp; memory == 0)</span><br><span class="line">		result = OJ_ML;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_update_solution_http(solution_id, result, time, memory, sim, sim_s_id,</span><br><span class="line">				pass_rate);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_update_solution_mysql(solution_id, result, time, memory, sim, sim_s_id,</span><br><span class="line">				pass_rate);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* write compile error message back to database */</span><br><span class="line">void _addceinfo_mysql(int solution_id) &#123;</span><br><span class="line">	char sql[(1 &lt;&lt; 16)], *end;</span><br><span class="line">	char ceinfo[(1 &lt;&lt; 16)], *cend;</span><br><span class="line">	FILE *fp = fopen("ce.txt", "re");</span><br><span class="line">	snprintf(sql, (1 &lt;&lt; 16) - 1, "DELETE FROM compileinfo WHERE solution_id=%d",</span><br><span class="line">			solution_id);</span><br><span class="line">	mysql_real_query(conn, sql, strlen(sql));</span><br><span class="line">	cend = ceinfo;</span><br><span class="line">	while (fgets(cend, 1024, fp)) &#123;</span><br><span class="line">		cend += strlen(cend);</span><br><span class="line">		if (cend - ceinfo &gt; 40000)</span><br><span class="line">			break;</span><br><span class="line">	&#125;</span><br><span class="line">	cend = 0;</span><br><span class="line">	end = sql;</span><br><span class="line">	strcpy(end, "INSERT INTO compileinfo VALUES(");</span><br><span class="line">	end += strlen(sql);</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	end += sprintf(end, "%d", solution_id);</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	*end++ = ',';</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	end += mysql_real_escape_string(conn, end, ceinfo, strlen(ceinfo));</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	*end++ = ')';</span><br><span class="line">	*end = 0;</span><br><span class="line">	//      printf("%s\n",ceinfo);</span><br><span class="line">	if (mysql_real_query(conn, sql, end - sql))</span><br><span class="line">		printf("%s\n", mysql_error(conn));</span><br><span class="line">	fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line">// urlencoded function copied from http://www.geekhideout.com/urlcode.shtml</span><br><span class="line">/* Converts a hex character to its integer value */</span><br><span class="line">char from_hex(char ch) &#123;</span><br><span class="line">	return isdigit(ch) ? ch - '0' : tolower(ch) - 'a' + 10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Converts an integer value to its hex character*/</span><br><span class="line">char to_hex(char code) &#123;</span><br><span class="line">	static char hex[] = "0123456789abcdef";</span><br><span class="line">	return hex[code &amp; 15];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Returns a url-encoded version of str */</span><br><span class="line">/* IMPORTANT: be sure to free() the returned string after use */</span><br><span class="line">char *url_encode(char *str) &#123;</span><br><span class="line">	char *pstr = str, *buf = (char *) malloc(strlen(str) * 3 + 1), *pbuf = buf;</span><br><span class="line">	while (*pstr) &#123;</span><br><span class="line">		if (isalnum(*pstr) || *pstr == '-' || *pstr == '_' || *pstr == '.'</span><br><span class="line">				|| *pstr == '~')</span><br><span class="line">			*pbuf++ = *pstr;</span><br><span class="line">		else if (*pstr == ' ')</span><br><span class="line">			*pbuf++ = '+';</span><br><span class="line">		else</span><br><span class="line">			*pbuf++ = '%', *pbuf++ = to_hex(*pstr &gt;&gt; 4), *pbuf++ = to_hex(</span><br><span class="line">					*pstr &amp; 15);</span><br><span class="line">		pstr++;</span><br><span class="line">	&#125;</span><br><span class="line">	*pbuf = '\0';</span><br><span class="line">	return buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _addceinfo_http(int solution_id) &#123;</span><br><span class="line"></span><br><span class="line">	char ceinfo[(1 &lt;&lt; 16)], *cend;</span><br><span class="line">	char * ceinfo_encode;</span><br><span class="line">	FILE *fp = fopen("ce.txt", "re");</span><br><span class="line"></span><br><span class="line">	cend = ceinfo;</span><br><span class="line">	while (fgets(cend, 1024, fp)) &#123;</span><br><span class="line">		cend += strlen(cend);</span><br><span class="line">		if (cend - ceinfo &gt; 40000)</span><br><span class="line">			break;</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(fp);</span><br><span class="line">	ceinfo_encode = url_encode(ceinfo);</span><br><span class="line">	FILE * ce = fopen("ce.post", "we");</span><br><span class="line">	fprintf(ce, "addceinfo=1&amp;sid=%d&amp;ceinfo=%s", solution_id, ceinfo_encode);</span><br><span class="line">	fclose(ce);</span><br><span class="line">	free(ceinfo_encode);</span><br><span class="line"></span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-file=\"ce.post\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, http_baseurl);</span><br><span class="line">	//fscanf(fjobs,"%d",&amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void addceinfo(int solution_id) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_addceinfo_http(solution_id);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_addceinfo_mysql(solution_id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* write runtime error message back to database */</span><br><span class="line">void _addreinfo_mysql(int solution_id, const char * filename) &#123;</span><br><span class="line">	char sql[(1 &lt;&lt; 16)], *end;</span><br><span class="line">	char reinfo[(1 &lt;&lt; 16)], *rend;</span><br><span class="line">	FILE *fp = fopen(filename, "re");</span><br><span class="line">	snprintf(sql, (1 &lt;&lt; 16) - 1, "DELETE FROM runtimeinfo WHERE solution_id=%d",</span><br><span class="line">			solution_id);</span><br><span class="line">	mysql_real_query(conn, sql, strlen(sql));</span><br><span class="line">	rend = reinfo;</span><br><span class="line">	while (fgets(rend, 1024, fp)) &#123;</span><br><span class="line">		rend += strlen(rend);</span><br><span class="line">		if (rend - reinfo &gt; 40000)</span><br><span class="line">			break;</span><br><span class="line">	&#125;</span><br><span class="line">	rend = 0;</span><br><span class="line">	end = sql;</span><br><span class="line">	strcpy(end, "INSERT INTO runtimeinfo VALUES(");</span><br><span class="line">	end += strlen(sql);</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	end += sprintf(end, "%d", solution_id);</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	*end++ = ',';</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	end += mysql_real_escape_string(conn, end, reinfo, strlen(reinfo));</span><br><span class="line">	*end++ = '\'';</span><br><span class="line">	*end++ = ')';</span><br><span class="line">	*end = 0;</span><br><span class="line">	//      printf("%s\n",ceinfo);</span><br><span class="line">	if (mysql_real_query(conn, sql, end - sql))</span><br><span class="line">		printf("%s\n", mysql_error(conn));</span><br><span class="line">	fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _addreinfo_http(int solution_id, const char * filename) &#123;</span><br><span class="line"></span><br><span class="line">	char reinfo[(1 &lt;&lt; 16)], *rend;</span><br><span class="line">	char * reinfo_encode;</span><br><span class="line">	FILE *fp = fopen(filename, "re");</span><br><span class="line"></span><br><span class="line">	rend = reinfo;</span><br><span class="line">	while (fgets(rend, 1024, fp)) &#123;</span><br><span class="line">		rend += strlen(rend);</span><br><span class="line">		if (rend - reinfo &gt; 40000)</span><br><span class="line">			break;</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(fp);</span><br><span class="line">	reinfo_encode = url_encode(reinfo);</span><br><span class="line">	FILE * re = fopen("re.post", "we");</span><br><span class="line">	fprintf(re, "addreinfo=1&amp;sid=%d&amp;reinfo=%s", solution_id, reinfo_encode);</span><br><span class="line">	fclose(re);</span><br><span class="line">	free(reinfo_encode);</span><br><span class="line"></span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-file=\"re.post\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, http_baseurl);</span><br><span class="line">	//fscanf(fjobs,"%d",&amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void addreinfo(int solution_id) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_addreinfo_http(solution_id, "error.out");</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_addreinfo_mysql(solution_id, "error.out");</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void adddiffinfo(int solution_id) &#123;</span><br><span class="line"></span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_addreinfo_http(solution_id, "diff.out");</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_addreinfo_mysql(solution_id, "diff.out");</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void addcustomout(int solution_id) &#123;</span><br><span class="line"></span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_addreinfo_http(solution_id, "user.out");</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_addreinfo_mysql(solution_id, "user.out");</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _update_user_mysql(char * user_id) &#123;</span><br><span class="line">	char sql[BUFFER_SIZE];</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"UPDATE `users` SET `solved`=(SELECT count(DISTINCT `problem_id`) FROM `solution` WHERE `user_id`=\'%s\' AND `result`=\'4\') WHERE `user_id`=\'%s\'",</span><br><span class="line">			user_id, user_id);</span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql)))</span><br><span class="line">		write_log(mysql_error(conn));</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"UPDATE `users` SET `submit`=(SELECT count(*) FROM `solution` WHERE `user_id`=\'%s\' and problem_id&gt;0) WHERE `user_id`=\'%s\'",</span><br><span class="line">			user_id, user_id);</span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql)))</span><br><span class="line">		write_log(mysql_error(conn));</span><br><span class="line">&#125;</span><br><span class="line">void _update_user_http(char * user_id) &#123;</span><br><span class="line"></span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-data=\"updateuser=1&amp;user_id=%s\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, user_id, http_baseurl);</span><br><span class="line">	//fscanf(fjobs,"%d",&amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line">&#125;</span><br><span class="line">void update_user(char * user_id) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_update_user_http(user_id);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_update_user_mysql(user_id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _update_problem_http(int pid) &#123;</span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-data=\"updateproblem=1&amp;pid=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, pid, http_baseurl);</span><br><span class="line">	//fscanf(fjobs,"%d",&amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line">&#125;</span><br><span class="line">void _update_problem_mysql(int p_id) &#123;</span><br><span class="line">	char sql[BUFFER_SIZE];</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"UPDATE `problem` SET `accepted`=(SELECT count(*) FROM `solution` WHERE `problem_id`=\'%d\' AND `result`=\'4\') WHERE `problem_id`=\'%d\'",</span><br><span class="line">			p_id, p_id);</span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql)))</span><br><span class="line">		write_log(mysql_error(conn));</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"UPDATE `problem` SET `submit`=(SELECT count(*) FROM `solution` WHERE `problem_id`=\'%d\') WHERE `problem_id`=\'%d\'",</span><br><span class="line">			p_id, p_id);</span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql)))</span><br><span class="line">		write_log(mysql_error(conn));</span><br><span class="line">&#125;</span><br><span class="line">void update_problem(int pid) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_update_problem_http(pid);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_update_problem_mysql(pid);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">int compile(int lang,char * work_dir) &#123;</span><br><span class="line">	int pid;</span><br><span class="line"></span><br><span class="line">	const char * CP_C[] = &#123; "gcc", "Main.c", "-o", "Main", "-fno-asm", "-Wall",</span><br><span class="line">			"-lm", "--static", "-std=c99", "-DONLINE_JUDGE", NULL &#125;;</span><br><span class="line">	const char * CP_X[] = &#123; "g++", "-fno-asm", "-Wall",</span><br><span class="line">			"-lm", "--static", "-std=c++11", "-DONLINE_JUDGE", "-o", "Main", "Main.cc", NULL &#125;;</span><br><span class="line">	const char * CP_P[] =</span><br><span class="line">			&#123; "fpc", "Main.pas","-Cs32000000","-Sh", "-O2", "-Co", "-Ct", "-Ci", NULL &#125;;</span><br><span class="line">//      const char * CP_J[] = &#123; "javac", "-J-Xms32m", "-J-Xmx256m","-encoding","UTF-8", "Main.java",NULL &#125;;</span><br><span class="line"></span><br><span class="line">	const char * CP_R[] = &#123; "ruby", "-c", "Main.rb", NULL &#125;;</span><br><span class="line">	const char * CP_B[] = &#123; "chmod", "+rx", "Main.sh", NULL &#125;;</span><br><span class="line">	//const char * CP_Y[] = &#123; "python", "-c",</span><br><span class="line">	//		"import py_compile; py_compile.compile(r'Main.py')", NULL &#125;;</span><br><span class="line">	const char * CP_PH[] = &#123; "php", "-l", "Main.php", NULL &#125;;</span><br><span class="line">	const char * CP_PL[] = &#123; "perl", "-c", "Main.pl", NULL &#125;;</span><br><span class="line">	const char * CP_CS[] = &#123; "gmcs", "-warn:0", "Main.cs", NULL &#125;;</span><br><span class="line">	const char * CP_OC[] = &#123; "gcc", "-o", "Main", "Main.m",</span><br><span class="line">			"-fconstant-string-class=NSConstantString", "-I",</span><br><span class="line">			"/usr/include/GNUstep/", "-L", "/usr/lib/GNUstep/Libraries/",</span><br><span class="line">			"-lobjc", "-lgnustep-base", NULL &#125;;</span><br><span class="line">	const char * CP_BS[] = &#123; "fbc","-lang","qb", "Main.bas", NULL &#125;;</span><br><span class="line">	const char * CP_CLANG[]=&#123;"clang", "Main.c", "-o", "Main", "-fno-asm", "-Wall",</span><br><span class="line">	         		"-lm", "--static", "-std=c99", "-DONLINE_JUDGE", NULL &#125;;</span><br><span class="line">	const char * CP_CLANG_CPP[]=&#123;"clang++", "Main.cc", "-o", "Main", "-fno-asm", "-Wall",</span><br><span class="line">	         		"-lm", "--static", "-std=c++0x",  "-DONLINE_JUDGE", NULL &#125;;</span><br><span class="line">	const char * CP_LUA[] = &#123; "luac","-o","Main", "Main.lua", NULL &#125;;</span><br><span class="line">	//const char * CP_JS[] = &#123; "js24","-c", "Main.js", NULL &#125;;</span><br><span class="line">	const char * CP_GO[] = &#123; "go","build","-o","Main","Main.go", NULL &#125;;</span><br><span class="line"></span><br><span class="line">	char javac_buf[7][32];</span><br><span class="line">	char *CP_J[7];</span><br><span class="line"></span><br><span class="line">	for (int i = 0; i &lt; 7; i++)</span><br><span class="line">		CP_J[i] = javac_buf[i];</span><br><span class="line"></span><br><span class="line">	sprintf(CP_J[0], "javac");</span><br><span class="line">	sprintf(CP_J[1], "-J%s", java_xms);</span><br><span class="line">	sprintf(CP_J[2], "-J%s", java_xmx);</span><br><span class="line">	sprintf(CP_J[3], "-encoding");</span><br><span class="line">	sprintf(CP_J[4], "UTF-8");</span><br><span class="line">	sprintf(CP_J[5], "Main.java");</span><br><span class="line">	CP_J[6] = (char *) NULL;</span><br><span class="line"></span><br><span class="line">	pid = fork();</span><br><span class="line">	if (pid == 0) &#123;</span><br><span class="line">		struct rlimit LIM;</span><br><span class="line">		LIM.rlim_max = 60;</span><br><span class="line">		LIM.rlim_cur = 60;</span><br><span class="line">		setrlimit(RLIMIT_CPU, &amp;LIM);</span><br><span class="line">		alarm(60);</span><br><span class="line">		LIM.rlim_max = 10 * STD_MB;</span><br><span class="line">		LIM.rlim_cur = 10 * STD_MB;</span><br><span class="line">		setrlimit(RLIMIT_FSIZE, &amp;LIM);</span><br><span class="line"></span><br><span class="line">		if(lang==3||lang==17)&#123;</span><br><span class="line">		   LIM.rlim_max = STD_MB &lt;&lt;11;</span><br><span class="line">		   LIM.rlim_cur = STD_MB &lt;&lt;11;	</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">		   LIM.rlim_max = STD_MB *256 ;</span><br><span class="line">		   LIM.rlim_cur = STD_MB *256 ;</span><br><span class="line">		&#125;</span><br><span class="line">		setrlimit(RLIMIT_AS, &amp;LIM);</span><br><span class="line">		if (lang != 2 &amp;&amp; lang != 11) &#123;</span><br><span class="line">			freopen("ce.txt", "w", stderr);</span><br><span class="line">			//freopen("/dev/null", "w", stdout);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			freopen("ce.txt", "w", stdout);</span><br><span class="line">		&#125;</span><br><span class="line">		if(lang != 3 &amp;&amp; lang != 9 &amp;&amp; lang != 6 &amp;&amp; lang != 11)&#123;</span><br><span class="line">			execute_cmd("mkdir -p bin usr lib lib64 etc/alternatives proc tmp dev");</span><br><span class="line">			execute_cmd("chown judge *");</span><br><span class="line">                	execute_cmd("mount -o bind /bin bin");</span><br><span class="line">                	execute_cmd("mount -o bind /usr usr");</span><br><span class="line">                	execute_cmd("mount -o bind /lib lib");</span><br><span class="line">#ifndef __i386</span><br><span class="line">                	execute_cmd("mount -o bind /lib64 lib64");</span><br><span class="line">#endif</span><br><span class="line">                	execute_cmd("mount -o bind /etc/alternatives etc/alternatives");</span><br><span class="line">                	execute_cmd("mount -o bind /proc proc");</span><br><span class="line">                	if(lang&gt;2 &amp;&amp; lang!=10 &amp;&amp; lang!=13 &amp;&amp; lang!=14)</span><br><span class="line">				execute_cmd("mount -o bind /dev dev");</span><br><span class="line">                        chroot(work_dir);</span><br><span class="line">		&#125;</span><br><span class="line">		while(setgid(1536)!=0) sleep(1);</span><br><span class="line">                while(setuid(1536)!=0) sleep(1);</span><br><span class="line">                while(setresuid(1536, 1536, 1536)!=0) sleep(1);</span><br><span class="line"></span><br><span class="line">		switch (lang) &#123;</span><br><span class="line">		case 0:</span><br><span class="line">			execvp(CP_C[0], (char * const *) CP_C);</span><br><span class="line">			break;</span><br><span class="line">		case 1:</span><br><span class="line">			execvp(CP_X[0], (char * const *) CP_X);</span><br><span class="line">			break;</span><br><span class="line">		case 2:</span><br><span class="line">			execvp(CP_P[0], (char * const *) CP_P);</span><br><span class="line">			break;</span><br><span class="line">		case 3:</span><br><span class="line">			execvp(CP_J[0], (char * const *) CP_J);</span><br><span class="line">			break;</span><br><span class="line">		case 4:</span><br><span class="line">			execvp(CP_R[0], (char * const *) CP_R);</span><br><span class="line">			break;</span><br><span class="line">		case 5:</span><br><span class="line">			execvp(CP_B[0], (char * const *) CP_B);</span><br><span class="line">			break;</span><br><span class="line">		//case 6:</span><br><span class="line">		//	execvp(CP_Y[0], (char * const *) CP_Y);</span><br><span class="line">		//	break;</span><br><span class="line">		case 7:</span><br><span class="line">			execvp(CP_PH[0], (char * const *) CP_PH);</span><br><span class="line">			break;</span><br><span class="line">		case 8:</span><br><span class="line">			execvp(CP_PL[0], (char * const *) CP_PL);</span><br><span class="line">			break;</span><br><span class="line">		case 9:</span><br><span class="line">			execvp(CP_CS[0], (char * const *) CP_CS);</span><br><span class="line">			break;</span><br><span class="line"></span><br><span class="line">		case 10:</span><br><span class="line">			execvp(CP_OC[0], (char * const *) CP_OC);</span><br><span class="line">			break;</span><br><span class="line">		case 11:</span><br><span class="line">			execvp(CP_BS[0], (char * const *) CP_BS);</span><br><span class="line">			break;</span><br><span class="line">		case 13:</span><br><span class="line">			execvp(CP_CLANG[0], (char * const *) CP_CLANG);</span><br><span class="line">			break;</span><br><span class="line">		case 14:</span><br><span class="line">			execvp(CP_CLANG_CPP[0], (char * const *) CP_CLANG_CPP);</span><br><span class="line">			break;</span><br><span class="line">		case 15:</span><br><span class="line">			execvp(CP_LUA[0], (char * const *) CP_LUA);</span><br><span class="line">			break;</span><br><span class="line">		//case 16:</span><br><span class="line">		//	execvp(CP_JS[0], (char * const *) CP_JS);</span><br><span class="line">		//	break;</span><br><span class="line">		case 17:</span><br><span class="line">			execvp(CP_GO[0], (char * const *) CP_GO);</span><br><span class="line">			break;</span><br><span class="line">		default:</span><br><span class="line">			printf("nothing to do!\n");</span><br><span class="line">		&#125;</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("compile end!\n");</span><br><span class="line">		//exit(!system("cat ce.txt"));</span><br><span class="line">		exit(0);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		int status = 0;</span><br><span class="line"></span><br><span class="line">		waitpid(pid, &amp;status, 0);</span><br><span class="line">		if (lang &gt; 3 &amp;&amp; lang &lt; 7)</span><br><span class="line">			status = get_file_size("ce.txt");</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("status=%d\n", status);</span><br><span class="line">		execute_cmd("/bin/umount bin usr lib lib64 etc/alternatives proc dev");</span><br><span class="line"> 		execute_cmd("/bin/umount %s/*",work_dir);</span><br><span class="line"> </span><br><span class="line">		return status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line"> int read_proc_statm(int pid)&#123;</span><br><span class="line"> FILE * pf;</span><br><span class="line"> char fn[4096];</span><br><span class="line"> int ret;</span><br><span class="line"> sprintf(fn,"/proc/%d/statm",pid);</span><br><span class="line"> pf=fopen(fn,"r");</span><br><span class="line"> fscanf(pf,"%d",&amp;ret);</span><br><span class="line"> fclose(pf);</span><br><span class="line"> return ret;</span><br><span class="line"> &#125;</span><br><span class="line"> */</span><br><span class="line">int get_proc_status(int pid, const char * mark) &#123;</span><br><span class="line">	FILE * pf;</span><br><span class="line">	char fn[BUFFER_SIZE], buf[BUFFER_SIZE];</span><br><span class="line">	int ret = 0;</span><br><span class="line">	sprintf(fn, "/proc/%d/status", pid);</span><br><span class="line">	pf = fopen(fn, "re");</span><br><span class="line">	int m = strlen(mark);</span><br><span class="line">	while (pf &amp;&amp; fgets(buf, BUFFER_SIZE - 1, pf)) &#123;</span><br><span class="line"></span><br><span class="line">		buf[strlen(buf) - 1] = 0;</span><br><span class="line">		if (strncmp(buf, mark, m) == 0) &#123;</span><br><span class="line">			sscanf(buf + m + 1, "%d", &amp;ret);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if (pf)</span><br><span class="line">		fclose(pf);</span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">int init_mysql_conn() &#123;</span><br><span class="line"></span><br><span class="line">	conn = mysql_init(NULL);</span><br><span class="line">	//mysql_real_connect(conn,host_name,user_name,password,db_name,port_number,0,0);</span><br><span class="line">	const char timeout = 30;</span><br><span class="line">	mysql_options(conn, MYSQL_OPT_CONNECT_TIMEOUT, &amp;timeout);</span><br><span class="line"></span><br><span class="line">	if (!mysql_real_connect(conn, host_name, user_name, password, db_name,</span><br><span class="line">			port_number, 0, 0)) &#123;</span><br><span class="line">		write_log("%s", mysql_error(conn));</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	const char * utf8sql = "set names utf8";</span><br><span class="line">	if (mysql_real_query(conn, utf8sql, strlen(utf8sql))) &#123;</span><br><span class="line">		write_log("%s", mysql_error(conn));</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	return 1;</span><br><span class="line">&#125;</span><br><span class="line">void _get_solution_mysql(int solution_id, char * work_dir, int lang) &#123;</span><br><span class="line">	char sql[BUFFER_SIZE], src_pth[BUFFER_SIZE];</span><br><span class="line">	// get the source code</span><br><span class="line">	MYSQL_RES *res;</span><br><span class="line">	MYSQL_ROW row;</span><br><span class="line">	sprintf(sql, "SELECT source FROM source_code WHERE solution_id=%d",</span><br><span class="line">			solution_id);</span><br><span class="line">	mysql_real_query(conn, sql, strlen(sql));</span><br><span class="line">	res = mysql_store_result(conn);</span><br><span class="line">	row = mysql_fetch_row(res);</span><br><span class="line"></span><br><span class="line">	// create the src file</span><br><span class="line">	sprintf(src_pth, "Main.%s", lang_ext[lang]);</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("Main=%s", src_pth);</span><br><span class="line">	FILE *fp_src = fopen(src_pth, "we");</span><br><span class="line">	fprintf(fp_src, "%s", row[0]);</span><br><span class="line">	mysql_free_result(res);</span><br><span class="line">	fclose(fp_src);</span><br><span class="line">&#125;</span><br><span class="line">void _get_solution_http(int solution_id, char * work_dir, int lang) &#123;</span><br><span class="line">	char src_pth[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">	// create the src file</span><br><span class="line">	sprintf(src_pth, "Main.%s", lang_ext[lang]);</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("Main=%s", src_pth);</span><br><span class="line"></span><br><span class="line">	//login();</span><br><span class="line"></span><br><span class="line">	const char * cmd2 =</span><br><span class="line">			"wget --post-data=\"getsolution=1&amp;sid=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O %s \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * pout = read_cmd_output(cmd2, solution_id, src_pth, http_baseurl);</span><br><span class="line"></span><br><span class="line">	pclose(pout);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void get_solution(int solution_id, char * work_dir, int lang) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_get_solution_http(solution_id, work_dir, lang);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_get_solution_mysql(solution_id, work_dir, lang);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _get_custominput_mysql(int solution_id, char * work_dir) &#123;</span><br><span class="line">	char sql[BUFFER_SIZE], src_pth[BUFFER_SIZE];</span><br><span class="line">	// get the source code</span><br><span class="line">	MYSQL_RES *res;</span><br><span class="line">	MYSQL_ROW row;</span><br><span class="line">	sprintf(sql, "SELECT input_text FROM custominput WHERE solution_id=%d",</span><br><span class="line">			solution_id);</span><br><span class="line">	mysql_real_query(conn, sql, strlen(sql));</span><br><span class="line">	res = mysql_store_result(conn);</span><br><span class="line">	row = mysql_fetch_row(res);</span><br><span class="line">	if (row != NULL) &#123;</span><br><span class="line"></span><br><span class="line">		// create the src file</span><br><span class="line">		sprintf(src_pth, "data.in");</span><br><span class="line">		FILE *fp_src = fopen(src_pth, "w");</span><br><span class="line">		fprintf(fp_src, "%s", row[0]);</span><br><span class="line">		fclose(fp_src);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	mysql_free_result(res);</span><br><span class="line">&#125;</span><br><span class="line">void _get_custominput_http(int solution_id, char * work_dir) &#123;</span><br><span class="line">	char src_pth[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">	// create the src file</span><br><span class="line">	sprintf(src_pth, "data.in");</span><br><span class="line"></span><br><span class="line">	//login();</span><br><span class="line"></span><br><span class="line">	const char * cmd2 =</span><br><span class="line">			"wget --post-data=\"getcustominput=1&amp;sid=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O %s \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * pout = read_cmd_output(cmd2, solution_id, src_pth, http_baseurl);</span><br><span class="line"></span><br><span class="line">	pclose(pout);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void get_custominput(int solution_id, char * work_dir) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_get_custominput_http(solution_id, work_dir);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_get_custominput_mysql(solution_id, work_dir);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _get_solution_info_mysql(int solution_id, int &amp; p_id, char * user_id,</span><br><span class="line">		int &amp; lang) &#123;</span><br><span class="line"></span><br><span class="line">	MYSQL_RES *res;</span><br><span class="line">	MYSQL_ROW row;</span><br><span class="line"></span><br><span class="line">	char sql[BUFFER_SIZE];</span><br><span class="line">	// get the problem id and user id from Table:solution</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"SELECT problem_id, user_id, language FROM solution where solution_id=%d",</span><br><span class="line">			solution_id);</span><br><span class="line">	//printf("%s\n",sql);</span><br><span class="line">	mysql_real_query(conn, sql, strlen(sql));</span><br><span class="line">	res = mysql_store_result(conn);</span><br><span class="line">	row = mysql_fetch_row(res);</span><br><span class="line">	p_id = atoi(row[0]);</span><br><span class="line">	strcpy(user_id, row[1]);</span><br><span class="line">	lang = atoi(row[2]);</span><br><span class="line">	mysql_free_result(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _get_solution_info_http(int solution_id, int &amp; p_id, char * user_id,</span><br><span class="line">		int &amp; lang) &#123;</span><br><span class="line"></span><br><span class="line">	login();</span><br><span class="line"></span><br><span class="line">	const char * cmd =</span><br><span class="line">			"wget --post-data=\"getsolutioninfo=1&amp;sid=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * pout = read_cmd_output(cmd, solution_id, http_baseurl);</span><br><span class="line">	fscanf(pout, "%d", &amp;p_id);</span><br><span class="line">	fscanf(pout, "%s", user_id);</span><br><span class="line">	fscanf(pout, "%d", &amp;lang);</span><br><span class="line">	pclose(pout);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void get_solution_info(int solution_id, int &amp; p_id, char * user_id,</span><br><span class="line">		int &amp; lang) &#123;</span><br><span class="line"></span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_get_solution_info_http(solution_id, p_id, user_id, lang);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_get_solution_info_mysql(solution_id, p_id, user_id, lang);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _get_problem_info_mysql(int p_id, int &amp; time_lmt, int &amp; mem_lmt,</span><br><span class="line">		int &amp; isspj) &#123;</span><br><span class="line">	// get the problem info from Table:problem</span><br><span class="line">	char sql[BUFFER_SIZE];</span><br><span class="line">	MYSQL_RES *res;</span><br><span class="line">	MYSQL_ROW row;</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"SELECT time_limit,memory_limit,spj FROM problem where problem_id=%d",</span><br><span class="line">			p_id);</span><br><span class="line">	mysql_real_query(conn, sql, strlen(sql));</span><br><span class="line">	res = mysql_store_result(conn);</span><br><span class="line">	row = mysql_fetch_row(res);</span><br><span class="line">	time_lmt = atoi(row[0]);</span><br><span class="line">	mem_lmt = atoi(row[1]);</span><br><span class="line">	isspj = (row[2][0] == '1');</span><br><span class="line">	mysql_free_result(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void _get_problem_info_http(int p_id, int &amp; time_lmt, int &amp; mem_lmt,</span><br><span class="line">		int &amp; isspj) &#123;</span><br><span class="line">	//login();</span><br><span class="line"></span><br><span class="line">	const char * cmd =</span><br><span class="line">			"wget --post-data=\"getprobleminfo=1&amp;pid=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * pout = read_cmd_output(cmd, p_id, http_baseurl);</span><br><span class="line">	fscanf(pout, "%d", &amp;time_lmt);</span><br><span class="line">	fscanf(pout, "%d", &amp;mem_lmt);</span><br><span class="line">	fscanf(pout, "%d", &amp;isspj);</span><br><span class="line">	pclose(pout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void get_problem_info(int p_id, int &amp; time_lmt, int &amp; mem_lmt, int &amp; isspj) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		_get_problem_info_http(p_id, time_lmt, mem_lmt, isspj);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		_get_problem_info_mysql(p_id, time_lmt, mem_lmt, isspj);</span><br><span class="line">	&#125;</span><br><span class="line">	if(time_lmt&lt;=0) time_lmt=1;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void prepare_files(char * filename, int namelen, char * infile, int &amp; p_id,</span><br><span class="line">		char * work_dir, char * outfile, char * userfile, int runner_id) &#123;</span><br><span class="line">	//              printf("ACflg=%d %d check a file!\n",ACflg,solution_id);</span><br><span class="line"></span><br><span class="line">	char fname[BUFFER_SIZE];</span><br><span class="line">	strncpy(fname, filename, namelen);</span><br><span class="line">	fname[namelen] = 0;</span><br><span class="line">	sprintf(infile, "%s/data/%d/%s.in", oj_home, p_id, fname);</span><br><span class="line">	execute_cmd("/bin/cp '%s' %s/data.in", infile, work_dir);</span><br><span class="line">	execute_cmd("/bin/cp %s/data/%d/*.dic %s/", oj_home, p_id, work_dir);</span><br><span class="line"></span><br><span class="line">	sprintf(outfile, "%s/data/%d/%s.out", oj_home, p_id, fname);</span><br><span class="line">	sprintf(userfile, "%s/run%d/user.out", oj_home, runner_id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void copy_shell_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/mkdir %s/lib", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/lib64", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/bin", work_dir);</span><br><span class="line"></span><br><span class="line">#ifdef __i386</span><br><span class="line">        execute_cmd("/bin/cp /lib/* %s/lib/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp -a /lib/i386-linux-gnu  %s/lib/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp -a /usr/lib/i386-linux-gnu %s/lib/", work_dir);</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/cp -a /lib/x86_64-linux-gnu %s/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /lib64/* %s/lib64/", work_dir);</span><br><span class="line">//	execute_cmd("/bin/cp /lib32 %s/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /bin/busybox %s/bin/", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/sh", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /bin/bash %s/bin/bash", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_objc_runtime(char * work_dir) &#123;</span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/proc", work_dir);</span><br><span class="line">	execute_cmd("/bin/mount -o bind /proc %s/proc", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/lib/", work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/libdbus-1.so.3                          %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/libgcc_s.so.1                           %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/libgcrypt.so.11                         %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/libgpg-error.so.0                       %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/libz.so.1                               %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/tls/i686/cmov/libc.so.6                 %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/tls/i686/cmov/libdl.so.2                %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/tls/i686/cmov/libm.so.6                 %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/tls/i686/cmov/libnsl.so.1               %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/tls/i686/cmov/libpthread.so.0           %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /lib/tls/i686/cmov/librt.so.1                %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libavahi-client.so.3                %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libavahi-common.so.3                %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libdns_sd.so.1                      %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libffi.so.5                         %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libgnustep-base.so.1.19             %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libgnutls.so.26                     %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libobjc.so.2                        %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libtasn1.so.3                       %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libxml2.so.2                        %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd(</span><br><span class="line">			"/bin/cp -aL /usr/lib/libxslt.so.1                        %s/lib/ ",</span><br><span class="line">			work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_bash_runtime(char * work_dir) &#123;</span><br><span class="line">	//char cmd[BUFFER_SIZE];</span><br><span class="line">	//const char * ruby_run="/usr/bin/ruby";</span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/cp `which bc`  %s/bin/", work_dir);</span><br><span class="line">	execute_cmd("busybox dos2unix Main.sh", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/grep", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/awk", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /bin/sed %s/bin/sed", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/cut", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/sort", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/join", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/wc", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/tr", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/dc", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/dd", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/cat", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/tail", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/head", work_dir);</span><br><span class="line">	execute_cmd("/bin/ln -s /bin/busybox %s/bin/xargs", work_dir);</span><br><span class="line">	execute_cmd("chmod +rx %s/Main.sh", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_ruby_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">        copy_shell_runtime(work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr", work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr/lib", work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr/lib64", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib/libruby* %s/usr/lib/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib/ruby* %s/usr/lib/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib64/ruby* %s/usr/lib64/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib64/libruby* %s/usr/lib64/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/bin/ruby* %s/", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void copy_guile_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/proc", work_dir);</span><br><span class="line">	execute_cmd("/bin/mount -o bind /proc %s/proc", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/lib", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/share", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp -a /usr/share/guile %s/usr/share/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libguile* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libgc* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/i386-linux-gnu/libffi* %s/usr/lib/",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/i386-linux-gnu/libunistring* %s/usr/lib/",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libgmp* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libgmp* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libltdl* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libltdl* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/bin/guile* %s/", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void copy_python_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">        copy_shell_runtime(work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr/include", work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/dev", work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr/lib", work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr/lib64", work_dir);</span><br><span class="line">        execute_cmd("mkdir -p %s/usr/local/lib", work_dir);</span><br><span class="line">        execute_cmd("cp /usr/bin/python* %s/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib/python* %s/usr/lib/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib64/python* %s/usr/lib64/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/local/lib/python* %s/usr/local/lib/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/include/python* %s/usr/include/", work_dir);</span><br><span class="line">        execute_cmd("cp -a /usr/lib/libpython* %s/usr/lib/", work_dir);</span><br><span class="line">        execute_cmd("/bin/mkdir -p %s/home/judge", work_dir);</span><br><span class="line">	execute_cmd("/bin/chown judge %s", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/etc", work_dir);</span><br><span class="line">	execute_cmd("/bin/grep judge /etc/passwd&gt;%s/etc/passwd", work_dir);</span><br><span class="line">	execute_cmd("/bin/mount -o bind /dev %s/dev", work_dir);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_php_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/usr", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/usr/lib", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libedit* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libdb* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libgssapi_krb5* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libkrb5* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libk5crypto* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libedit* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libdb* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libgssapi_krb5* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libkrb5* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/*/libk5crypto* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libxml2* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/x86_64-linux-gnu/libxml2.so* %s/usr/lib/",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/bin/php* %s/", work_dir);</span><br><span class="line">	execute_cmd("chmod +rx %s/Main.php", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_perl_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/usr", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/usr/lib", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libperl* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/bin/perl* %s/", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_freebasic_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/local/lib", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/local/bin", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/local/lib/freebasic %s/usr/local/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/local/bin/fbc %s/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp -a /lib32/* %s/lib/", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_mono_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/usr", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir %s/proc", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/lib/mono/2.0", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp -a /usr/lib/mono %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/lib64/mono/2.0", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp -a /usr/lib64/mono %s/usr/lib64/", work_dir);</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libgthread* %s/usr/lib/", work_dir);</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/mount -o bind /proc %s/proc", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/bin/mono* %s/", work_dir);</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/cp /usr/lib/libgthread* %s/usr/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /lib/libglib* %s/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /lib/tls/i686/cmov/lib* %s/lib/tls/i686/cmov/",</span><br><span class="line">			work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /lib/libpcre* %s/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /lib/ld-linux* %s/lib/", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /lib64/ld-linux* %s/lib64/", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/home/judge", work_dir);</span><br><span class="line">	execute_cmd("/bin/chown judge %s/home/judge", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/etc", work_dir);</span><br><span class="line">	execute_cmd("/bin/grep judge /etc/passwd&gt;%s/etc/passwd", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_lua_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/local/lib", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/local/bin", work_dir);</span><br><span class="line">	execute_cmd("/bin/cp /usr/bin/lua %s/", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void copy_js_runtime(char * work_dir) &#123;</span><br><span class="line"></span><br><span class="line">//	copy_shell_runtime(work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/lib /lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libz.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /usr/lib/i386-linux-gnu/libcares.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /usr/lib/libv8.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libssl.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libcrypto.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libdl.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/librt.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /usr/lib/i386-linux-gnu/libstdc++.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libpthread.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libc.so.6  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libm.so.6  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/i386-linux-gnu/libgcc_s.so.1  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/ld-linux.so.*  %s/lib/i386-linux-gnu/", work_dir);</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/mkdir -p %s/usr/lib /lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libz.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /usr/lib/x86_64-linux-gnu/libcares.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /usr/lib/libv8.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libssl.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libcrypto.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libdl.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/librt.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /usr/lib/x86_64-linux-gnu/libstdc++.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libpthread.so.*  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libc.so.6  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libm.so.6  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib/x86_64-linux-gnu/libgcc_s.so.1  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line">        execute_cmd("/bin/cp /lib64/ld-linux-x86-64.so.2  %s/lib/x86_64-linux-gnu/", work_dir);</span><br><span class="line"></span><br><span class="line">	execute_cmd("/bin/cp /usr/bin/nodejs %s/", work_dir);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void run_solution(int &amp; lang, char * work_dir, int &amp; time_lmt, int &amp; usedtime,</span><br><span class="line">		int &amp; mem_lmt) &#123;</span><br><span class="line">	nice(19);</span><br><span class="line">	// now the user is "judger"</span><br><span class="line">	chdir(work_dir);</span><br><span class="line">	// open the files</span><br><span class="line">	freopen("data.in", "r", stdin);</span><br><span class="line">	freopen("user.out", "w", stdout);</span><br><span class="line">	freopen("error.out", "a+", stderr);</span><br><span class="line">	// trace me</span><br><span class="line">	if(use_ptrace) ptrace(PTRACE_TRACEME, 0, NULL, NULL);</span><br><span class="line">	// run me</span><br><span class="line">	if (lang != 3)</span><br><span class="line">		chroot(work_dir);</span><br><span class="line"></span><br><span class="line">	while (setgid(1536) != 0)</span><br><span class="line">		sleep(1);</span><br><span class="line">	while (setuid(1536) != 0)</span><br><span class="line">		sleep(1);</span><br><span class="line">	while (setresuid(1536, 1536, 1536) != 0)</span><br><span class="line">		sleep(1);</span><br><span class="line"></span><br><span class="line">//      char java_p1[BUFFER_SIZE], java_p2[BUFFER_SIZE];</span><br><span class="line">	// child</span><br><span class="line">	// set the limit</span><br><span class="line">	struct rlimit LIM; // time limit, file limit&amp; memory limit</span><br><span class="line">	// time limit</span><br><span class="line">	if (oi_mode)</span><br><span class="line">		LIM.rlim_cur = time_lmt + 1;</span><br><span class="line">	else</span><br><span class="line">		LIM.rlim_cur = (time_lmt - usedtime / 1000) + 1;</span><br><span class="line">	LIM.rlim_max = LIM.rlim_cur;</span><br><span class="line">	//if(DEBUG) printf("LIM_CPU=%d",(int)(LIM.rlim_cur));</span><br><span class="line">	setrlimit(RLIMIT_CPU, &amp;LIM);</span><br><span class="line">	alarm(0);</span><br><span class="line">	alarm(time_lmt * 10);</span><br><span class="line"></span><br><span class="line">	// file limit</span><br><span class="line">	LIM.rlim_max = STD_F_LIM + STD_MB;</span><br><span class="line">	LIM.rlim_cur = STD_F_LIM;</span><br><span class="line">	setrlimit(RLIMIT_FSIZE, &amp;LIM);</span><br><span class="line">	// proc limit</span><br><span class="line">	switch (lang) &#123;</span><br><span class="line">	case 17:  </span><br><span class="line">		LIM.rlim_cur = LIM.rlim_max = 280;</span><br><span class="line">		break;</span><br><span class="line">	case 3:  //java</span><br><span class="line">	case 4:  //ruby</span><br><span class="line">	case 9: //C#</span><br><span class="line">	case 12:</span><br><span class="line">	case 16:</span><br><span class="line">		LIM.rlim_cur = LIM.rlim_max = 80;</span><br><span class="line">		break;</span><br><span class="line">	case 5: //bash</span><br><span class="line">		LIM.rlim_cur = LIM.rlim_max = 3;</span><br><span class="line">		break;</span><br><span class="line">	default:</span><br><span class="line">		LIM.rlim_cur = LIM.rlim_max = 1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	setrlimit(RLIMIT_NPROC, &amp;LIM);</span><br><span class="line"></span><br><span class="line">	// set the stack</span><br><span class="line">	LIM.rlim_cur = STD_MB &lt;&lt; 6;</span><br><span class="line">	LIM.rlim_max = STD_MB &lt;&lt; 6;</span><br><span class="line">	setrlimit(RLIMIT_STACK, &amp;LIM);</span><br><span class="line">	// set the memory</span><br><span class="line">	LIM.rlim_cur = STD_MB * mem_lmt / 2 * 3;</span><br><span class="line">	LIM.rlim_max = STD_MB * mem_lmt * 2;</span><br><span class="line">	if (lang &lt; 3)</span><br><span class="line">		setrlimit(RLIMIT_AS, &amp;LIM);</span><br><span class="line"></span><br><span class="line">	switch (lang) &#123;</span><br><span class="line">	case 0:</span><br><span class="line">	case 1:</span><br><span class="line">	case 2:</span><br><span class="line">	case 10:</span><br><span class="line">	case 11:</span><br><span class="line">	case 13:</span><br><span class="line">	case 14:</span><br><span class="line">	case 17:</span><br><span class="line">		execl("./Main", "./Main", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 3:</span><br><span class="line">              sprintf(java_xms, "-Xmx%dM", mem_lmt);</span><br><span class="line">              //sprintf(java_xmx, "-XX:MaxPermSize=%dM", mem_lmt);</span><br><span class="line"></span><br><span class="line">		execl("/usr/bin/java", "/usr/bin/java", java_xms, java_xmx,</span><br><span class="line">				"-Djava.security.manager",</span><br><span class="line">				"-Djava.security.policy=./java.policy", "Main", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 4:</span><br><span class="line">		//system("/ruby Main.rb&lt;data.in");</span><br><span class="line">		execl("/ruby", "/ruby", "Main.rb", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 5: //bash</span><br><span class="line">		execl("/bin/bash", "/bin/bash", "Main.sh", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 6: //Python</span><br><span class="line">		execl("/python", "/python", "Main.py", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 7: //php</span><br><span class="line">		execl("/php", "/php", "Main.php", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 8: //perl</span><br><span class="line">		execl("/perl", "/perl", "Main.pl", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 9: //Mono C#</span><br><span class="line">		execl("/mono", "/mono", "--debug", "Main.exe", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 12: //guile</span><br><span class="line">		execl("/guile", "/guile", "Main.scm", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 15: //guile</span><br><span class="line">		execl("/lua", "/lua", "Main", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line">	case 16: //SpiderMonkey</span><br><span class="line">		execl("/nodejs", "/nodejs", "Main.js", (char *) NULL);</span><br><span class="line">		break;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	//sleep(1);</span><br><span class="line">	fflush(stderr);</span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br><span class="line">int fix_python_mis_judge(char *work_dir, int &amp; ACflg, int &amp; topmemory,</span><br><span class="line">                int mem_lmt) &#123;</span><br><span class="line">        int comp_res = OJ_AC;</span><br><span class="line"></span><br><span class="line">        comp_res = execute_cmd(</span><br><span class="line">                        "/bin/grep 'MemoryError'  %s/error.out", work_dir);</span><br><span class="line"></span><br><span class="line">        if (!comp_res) &#123;</span><br><span class="line">                printf("Python need more Memory!");</span><br><span class="line">                ACflg = OJ_ML;</span><br><span class="line">                topmemory = mem_lmt * STD_MB;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return comp_res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int fix_java_mis_judge(char *work_dir, int &amp; ACflg, int &amp; topmemory,</span><br><span class="line">		int mem_lmt) &#123;</span><br><span class="line">	int comp_res = OJ_AC;</span><br><span class="line">	execute_cmd("chmod 700 %s/error.out", work_dir);</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		execute_cmd("cat %s/error.out", work_dir);</span><br><span class="line">	comp_res = execute_cmd("/bin/grep 'Exception'  %s/error.out", work_dir);</span><br><span class="line">	if (!comp_res) &#123;</span><br><span class="line">		printf("Exception reported\n");</span><br><span class="line">		ACflg = OJ_RE;</span><br><span class="line">	&#125;</span><br><span class="line">	execute_cmd("cat %s/error.out", work_dir);</span><br><span class="line"></span><br><span class="line">	comp_res = execute_cmd(</span><br><span class="line">			"/bin/grep 'java.lang.OutOfMemoryError'  %s/error.out", work_dir);</span><br><span class="line"></span><br><span class="line">	if (!comp_res) &#123;</span><br><span class="line">		printf("JVM need more Memory!");</span><br><span class="line">		ACflg = OJ_ML;</span><br><span class="line">		topmemory = mem_lmt * STD_MB;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (!comp_res) &#123;</span><br><span class="line">		printf("JVM need more Memory or Threads!");</span><br><span class="line">		ACflg = OJ_ML;</span><br><span class="line">		topmemory = mem_lmt * STD_MB;</span><br><span class="line">	&#125;</span><br><span class="line">	comp_res = execute_cmd("/bin/grep 'Could not create'  %s/error.out",</span><br><span class="line">			work_dir);</span><br><span class="line">	if (!comp_res) &#123;</span><br><span class="line">		printf("jvm need more resource,tweak -Xmx(OJ_JAVA_BONUS) Settings");</span><br><span class="line">		ACflg = OJ_RE;</span><br><span class="line">		//topmemory=0;</span><br><span class="line">	&#125;</span><br><span class="line">	return comp_res;</span><br><span class="line">&#125;</span><br><span class="line">int special_judge(char* oj_home, int problem_id, char *infile, char *outfile,</span><br><span class="line">		char *userfile) &#123;</span><br><span class="line"></span><br><span class="line">	pid_t pid;</span><br><span class="line">	printf("pid=%d\n", problem_id);</span><br><span class="line">	pid = fork();</span><br><span class="line">	int ret = 0;</span><br><span class="line">	if (pid == 0) &#123;</span><br><span class="line"></span><br><span class="line">		while (setgid(1536) != 0)</span><br><span class="line">			sleep(1);</span><br><span class="line">		while (setuid(1536) != 0)</span><br><span class="line">			sleep(1);</span><br><span class="line">		while (setresuid(1536, 1536, 1536) != 0)</span><br><span class="line">			sleep(1);</span><br><span class="line"></span><br><span class="line">		struct rlimit LIM; // time limit, file limit&amp; memory limit</span><br><span class="line"></span><br><span class="line">		LIM.rlim_cur = 5;</span><br><span class="line">		LIM.rlim_max = LIM.rlim_cur;</span><br><span class="line">		setrlimit(RLIMIT_CPU, &amp;LIM);</span><br><span class="line">		alarm(0);</span><br><span class="line">		alarm(10);</span><br><span class="line"></span><br><span class="line">		// file limit</span><br><span class="line">		LIM.rlim_max = STD_F_LIM + STD_MB;</span><br><span class="line">		LIM.rlim_cur = STD_F_LIM;</span><br><span class="line">		setrlimit(RLIMIT_FSIZE, &amp;LIM);</span><br><span class="line"></span><br><span class="line">		ret = execute_cmd("%s/data/%d/spj %s %s %s", oj_home, problem_id,</span><br><span class="line">				infile, outfile, userfile);</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("spj1=%d\n", ret);</span><br><span class="line">		if (ret)</span><br><span class="line">			exit(1);</span><br><span class="line">		else</span><br><span class="line">			exit(0);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		int status;</span><br><span class="line"></span><br><span class="line">		waitpid(pid, &amp;status, 0);</span><br><span class="line">		ret = WEXITSTATUS(status);</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("spj2=%d\n", ret);</span><br><span class="line">	&#125;</span><br><span class="line">	return ret;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void judge_solution(int &amp; ACflg, int &amp; usedtime, int time_lmt, int isspj,</span><br><span class="line">		int p_id, char * infile, char * outfile, char * userfile, int &amp; PEflg,</span><br><span class="line">		int lang, char * work_dir, int &amp; topmemory, int mem_lmt,</span><br><span class="line">		int solution_id, int num_of_test) &#123;</span><br><span class="line">	//usedtime-=1000;</span><br><span class="line">	int comp_res;</span><br><span class="line">	if (!oi_mode)</span><br><span class="line">		num_of_test = 1.0;</span><br><span class="line">	if (ACflg == OJ_AC</span><br><span class="line">			&amp;&amp; usedtime &gt; time_lmt * 1000 * (use_max_time ? 1 : num_of_test))</span><br><span class="line">		ACflg = OJ_TL;</span><br><span class="line">	if (topmemory &gt; mem_lmt * STD_MB)</span><br><span class="line">		ACflg = OJ_ML; //issues79</span><br><span class="line">	// compare</span><br><span class="line">	if (ACflg == OJ_AC) &#123;</span><br><span class="line">		if (isspj) &#123;</span><br><span class="line">			comp_res = special_judge(oj_home, p_id, infile, outfile, userfile);</span><br><span class="line"></span><br><span class="line">			if (comp_res == 0)</span><br><span class="line">				comp_res = OJ_AC;</span><br><span class="line">			else &#123;</span><br><span class="line">				if (DEBUG)</span><br><span class="line">					printf("fail test %s\n", infile);</span><br><span class="line">				comp_res = OJ_WA;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			comp_res = compare(outfile, userfile);</span><br><span class="line">		&#125;</span><br><span class="line">		if (comp_res == OJ_WA) &#123;</span><br><span class="line">			ACflg = OJ_WA;</span><br><span class="line">			if (DEBUG)</span><br><span class="line">				printf("fail test %s\n", infile);</span><br><span class="line">		&#125; else if (comp_res == OJ_PE)</span><br><span class="line">			PEflg = OJ_PE;</span><br><span class="line">		ACflg = comp_res;</span><br><span class="line">	&#125;</span><br><span class="line">	//jvm popup messages, if don't consider them will get miss-WrongAnswer</span><br><span class="line">	if (lang == 3) &#123;</span><br><span class="line">		comp_res = fix_java_mis_judge(work_dir, ACflg, topmemory, mem_lmt);</span><br><span class="line">	&#125;</span><br><span class="line">	if (lang == 6) &#123;</span><br><span class="line">		comp_res = fix_python_mis_judge(work_dir, ACflg, topmemory, mem_lmt);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int get_page_fault_mem(struct rusage &amp; ruse, pid_t &amp; pidApp) &#123;</span><br><span class="line">	//java use pagefault</span><br><span class="line">	int m_vmpeak, m_vmdata, m_minflt;</span><br><span class="line">	m_minflt = ruse.ru_minflt * getpagesize();</span><br><span class="line">	if (0 &amp;&amp; DEBUG) &#123;</span><br><span class="line">		m_vmpeak = get_proc_status(pidApp, "VmPeak:");</span><br><span class="line">		m_vmdata = get_proc_status(pidApp, "VmData:");</span><br><span class="line">		printf("VmPeak:%d KB VmData:%d KB minflt:%d KB\n", m_vmpeak, m_vmdata,</span><br><span class="line">				m_minflt &gt;&gt; 10);</span><br><span class="line">	&#125;</span><br><span class="line">	return m_minflt;</span><br><span class="line">&#125;</span><br><span class="line">void print_runtimeerror(char * err) &#123;</span><br><span class="line">	FILE *ferr = fopen("error.out", "a+");</span><br><span class="line">	fprintf(ferr, "Runtime Error:%s\n", err);</span><br><span class="line">	fclose(ferr);</span><br><span class="line">&#125;</span><br><span class="line">void clean_session(pid_t p) &#123;</span><br><span class="line">	//char cmd[BUFFER_SIZE];</span><br><span class="line">	const char *pre = "ps awx -o \"\%p \%P\"|grep -w ";</span><br><span class="line">	const char *post = " | awk \'&#123; print $1  &#125;\'|xargs kill -9";</span><br><span class="line">	execute_cmd("%s %d %s", pre, p, post);</span><br><span class="line">	execute_cmd("ps aux |grep \\^judge|awk '&#123;print $2&#125;'|xargs kill");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void watch_solution(pid_t pidApp, char * infile, int &amp; ACflg, int isspj,</span><br><span class="line">		char * userfile, char * outfile, int solution_id, int lang,</span><br><span class="line">		int &amp; topmemory, int mem_lmt, int &amp; usedtime, int time_lmt, int &amp; p_id,</span><br><span class="line">		int &amp; PEflg, char * work_dir) &#123;</span><br><span class="line">	// parent</span><br><span class="line">	int tempmemory;</span><br><span class="line"></span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("pid=%d judging %s\n", pidApp, infile);</span><br><span class="line"></span><br><span class="line">	int status, sig, exitcode;</span><br><span class="line">	struct user_regs_struct reg;</span><br><span class="line">	struct rusage ruse;</span><br><span class="line">	if(topmemory==0) </span><br><span class="line">			topmemory= get_proc_status(pidApp, "VmRSS:") &lt;&lt; 10;</span><br><span class="line">	while (1) &#123;</span><br><span class="line">		// check the usage</span><br><span class="line"></span><br><span class="line">		wait4(pidApp, &amp;status, 0, &amp;ruse);</span><br><span class="line"></span><br><span class="line">//jvm gc ask VM before need,so used kernel page fault times and page size</span><br><span class="line">		if (lang == 3 || lang == 7 || lang == 16 || lang==9 ||lang==17) &#123;</span><br><span class="line">			tempmemory = get_page_fault_mem(ruse, pidApp);</span><br><span class="line">		&#125; else &#123;        //other use VmPeak</span><br><span class="line">			tempmemory = get_proc_status(pidApp, "VmPeak:") &lt;&lt; 10;</span><br><span class="line">		&#125;</span><br><span class="line">		if (tempmemory &gt; topmemory)</span><br><span class="line">			topmemory = tempmemory;</span><br><span class="line">		if (topmemory &gt; mem_lmt * STD_MB) &#123;</span><br><span class="line">			if (DEBUG)</span><br><span class="line">				printf("out of memory %d\n", topmemory);</span><br><span class="line">			if (ACflg == OJ_AC)</span><br><span class="line">				ACflg = OJ_ML;</span><br><span class="line">			ptrace(PTRACE_KILL, pidApp, NULL, NULL);</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		//sig = status &gt;&gt; 8;/*status &gt;&gt; 8 Ã¥Â·Â®Ã¤Â¸ÂÃ¥Â¤Å¡Ã¦ËÂ¯EXITCODE*/</span><br><span class="line"></span><br><span class="line">		if (WIFEXITED(status))</span><br><span class="line">			break;</span><br><span class="line">		if ((lang &lt; 4 || lang == 9) &amp;&amp; get_file_size("error.out") &amp;&amp; !oi_mode) &#123;</span><br><span class="line">			ACflg = OJ_RE;</span><br><span class="line">			//addreinfo(solution_id);</span><br><span class="line">			ptrace(PTRACE_KILL, pidApp, NULL, NULL);</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (!isspj</span><br><span class="line">				&amp;&amp; get_file_size(userfile)</span><br><span class="line">						&gt; get_file_size(outfile) * 2 + 1024) &#123;</span><br><span class="line">			ACflg = OJ_OL;</span><br><span class="line">			ptrace(PTRACE_KILL, pidApp, NULL, NULL);</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		exitcode = WEXITSTATUS(status);</span><br><span class="line">		/*exitcode == 5 waiting for next CPU allocation          * ruby using system to run,exit 17 ok</span><br><span class="line">		 *  */</span><br><span class="line">		if ((lang &gt;= 3 &amp;&amp; exitcode == 17) || exitcode == 0x05 || exitcode == 0)</span><br><span class="line">			//go on and on</span><br><span class="line">			;</span><br><span class="line">		else &#123;</span><br><span class="line"></span><br><span class="line">			if (DEBUG) &#123;</span><br><span class="line">				printf("status&gt;&gt;8=%d\n", exitcode);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			//psignal(exitcode, NULL);</span><br><span class="line"></span><br><span class="line">			if (ACflg == OJ_AC) &#123;</span><br><span class="line">				switch (exitcode) &#123;</span><br><span class="line">				case SIGCHLD:</span><br><span class="line">				case SIGALRM:</span><br><span class="line">					alarm(0);</span><br><span class="line">				case SIGKILL:</span><br><span class="line">				case SIGXCPU:</span><br><span class="line">					ACflg = OJ_TL;</span><br><span class="line">					break;</span><br><span class="line">				case SIGXFSZ:</span><br><span class="line">					ACflg = OJ_OL;</span><br><span class="line">					break;</span><br><span class="line">				default:</span><br><span class="line">					ACflg = OJ_RE;</span><br><span class="line">				&#125;</span><br><span class="line">				print_runtimeerror(strsignal(exitcode));</span><br><span class="line">			&#125;</span><br><span class="line">			ptrace(PTRACE_KILL, pidApp, NULL, NULL);</span><br><span class="line"></span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		if (WIFSIGNALED(status)) &#123;</span><br><span class="line">			/*  WIFSIGNALED: if the process is terminated by signal</span><br><span class="line">			 *</span><br><span class="line">			 *  psignal(int sig, char *s)，like perror(char *s)，print out s, with error msg from system of sig  </span><br><span class="line">			 * sig = 5 means Trace/breakpoint trap</span><br><span class="line">			 * sig = 11 means Segmentation fault</span><br><span class="line">			 * sig = 25 means File size limit exceeded</span><br><span class="line">			 */</span><br><span class="line">			sig = WTERMSIG(status);</span><br><span class="line"></span><br><span class="line">			if (DEBUG) &#123;</span><br><span class="line">				printf("WTERMSIG=%d\n", sig);</span><br><span class="line">				psignal(sig, NULL);</span><br><span class="line">			&#125;</span><br><span class="line">			if (ACflg == OJ_AC) &#123;</span><br><span class="line">				switch (sig) &#123;</span><br><span class="line">				case SIGCHLD:</span><br><span class="line">				case SIGALRM:</span><br><span class="line">					alarm(0);</span><br><span class="line">				case SIGKILL:</span><br><span class="line">				case SIGXCPU:</span><br><span class="line">					ACflg = OJ_TL;</span><br><span class="line">					break;</span><br><span class="line">				case SIGXFSZ:</span><br><span class="line">					ACflg = OJ_OL;</span><br><span class="line">					break;</span><br><span class="line"></span><br><span class="line">				default:</span><br><span class="line">					ACflg = OJ_RE;</span><br><span class="line">				&#125;</span><br><span class="line">				print_runtimeerror(strsignal(sig));</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		/*     comment from http://www.felix021.com/blog/read.php?1662</span><br><span class="line"></span><br><span class="line">		 WIFSTOPPED: return true if the process is paused or stopped while ptrace is watching on it</span><br><span class="line">		 WSTOPSIG: get the signal if it was stopped by signal</span><br><span class="line">		 */</span><br><span class="line"></span><br><span class="line">		// check the system calls</span><br><span class="line">		ptrace(PTRACE_GETREGS, pidApp, NULL, &amp;reg);</span><br><span class="line">		if (call_counter[reg.REG_SYSCALL] )&#123;</span><br><span class="line">			//call_counter[reg.REG_SYSCALL]--;</span><br><span class="line">		&#125;else if (record_call) &#123;</span><br><span class="line">			call_counter[reg.REG_SYSCALL] = 1;</span><br><span class="line">		</span><br><span class="line">		&#125;else &#123; //do not limit JVM syscall for using different JVM</span><br><span class="line">			ACflg = OJ_RE;</span><br><span class="line">			char error[BUFFER_SIZE];</span><br><span class="line">			sprintf(error,</span><br><span class="line">                                        "[ERROR] A Not allowed system call: runid:%d CALLID:%ld\n"</span><br><span class="line">                                        " TO FIX THIS , ask admin to add the CALLID into corresponding LANG_XXV[] located at okcalls32/64.h ,\n"</span><br><span class="line">                                        "and recompile judge_client. \n"</span><br><span class="line">                                        "if you are admin and you don't know what to do ,\n"</span><br><span class="line">                                        " tech support can be found on http://hustoj.taobao.com\n",</span><br><span class="line">                                        solution_id, (long)reg.REG_SYSCALL);</span><br><span class="line"> </span><br><span class="line">			write_log(error);</span><br><span class="line">			print_runtimeerror(error);</span><br><span class="line">			ptrace(PTRACE_KILL, pidApp, NULL, NULL);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		ptrace(PTRACE_SYSCALL, pidApp, NULL, NULL);</span><br><span class="line">	&#125;</span><br><span class="line">	usedtime += (ruse.ru_utime.tv_sec * 1000 + ruse.ru_utime.tv_usec / 1000);</span><br><span class="line">	usedtime += (ruse.ru_stime.tv_sec * 1000 + ruse.ru_stime.tv_usec / 1000);</span><br><span class="line">	</span><br><span class="line">	//clean_session(pidApp);</span><br><span class="line">&#125;</span><br><span class="line">void umount(char * work_dir)&#123;</span><br><span class="line">        execute_cmd("/bin/umount %s/proc", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/dev", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/lib", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/lib64", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/etc/alternatives", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/usr", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/bin", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount %s/proc", work_dir);</span><br><span class="line">        execute_cmd("/bin/umount bin usr lib lib64 etc/alternatives proc dev");</span><br><span class="line">        execute_cmd("/bin/umount %s/*",work_dir);</span><br><span class="line">&#125;</span><br><span class="line">void clean_workdir(char * work_dir) &#123;</span><br><span class="line">	umount(work_dir);</span><br><span class="line"> 	if (DEBUG) &#123;</span><br><span class="line">		execute_cmd("mkdir %s/log/", work_dir);</span><br><span class="line">		execute_cmd("/bin/mv %s/* %s/log/", work_dir, work_dir);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		execute_cmd("/bin/rm -f %s/*", work_dir);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init_parameters(int argc, char ** argv, int &amp; solution_id,</span><br><span class="line">		int &amp; runner_id) &#123;</span><br><span class="line">	if (argc &lt; 3) &#123;</span><br><span class="line">		fprintf(stderr, "Usage:%s solution_id runner_id.\n", argv[0]);</span><br><span class="line">		fprintf(stderr, "Multi:%s solution_id runner_id judge_base_path.\n",</span><br><span class="line">				argv[0]);</span><br><span class="line">		fprintf(stderr,</span><br><span class="line">				"Debug:%s solution_id runner_id judge_base_path debug.\n",</span><br><span class="line">				argv[0]);</span><br><span class="line">		exit(1);</span><br><span class="line">	&#125;</span><br><span class="line">	DEBUG = (argc &gt; 4);</span><br><span class="line">	record_call = (argc &gt; 5);</span><br><span class="line">	if (argc &gt; 5) &#123;</span><br><span class="line">		strcpy(LANG_NAME, argv[5]);</span><br><span class="line">	&#125;</span><br><span class="line">	if (argc &gt; 3)</span><br><span class="line">		strcpy(oj_home, argv[3]);</span><br><span class="line">	else</span><br><span class="line">		strcpy(oj_home, "/home/judge");</span><br><span class="line"></span><br><span class="line">	chdir(oj_home); // change the dir// init our work</span><br><span class="line"></span><br><span class="line">	solution_id = atoi(argv[1]);</span><br><span class="line">	runner_id = atoi(argv[2]);</span><br><span class="line">&#125;</span><br><span class="line">int get_sim(int solution_id, int lang, int pid, int &amp;sim_s_id) &#123;</span><br><span class="line">	char src_pth[BUFFER_SIZE];</span><br><span class="line">	//char cmd[BUFFER_SIZE];</span><br><span class="line">	sprintf(src_pth, "Main.%s", lang_ext[lang]);</span><br><span class="line"></span><br><span class="line">	int sim = execute_cmd("/usr/bin/sim.sh %s %d", src_pth, pid);</span><br><span class="line">	if (!sim) &#123;</span><br><span class="line">		execute_cmd("/bin/mkdir ../data/%d/ac/", pid);</span><br><span class="line"></span><br><span class="line">		execute_cmd("/bin/cp %s ../data/%d/ac/%d.%s", src_pth, pid, solution_id,</span><br><span class="line">				lang_ext[lang]);</span><br><span class="line">		//c cpp will</span><br><span class="line">		if (lang == 0)</span><br><span class="line">			execute_cmd("/bin/ln ../data/%d/ac/%d.%s ../data/%d/ac/%d.%s", pid,</span><br><span class="line">					solution_id, lang_ext[lang], pid, solution_id,</span><br><span class="line">					lang_ext[lang + 1]);</span><br><span class="line">		if (lang == 1)</span><br><span class="line">			execute_cmd("/bin/ln ../data/%d/ac/%d.%s ../data/%d/ac/%d.%s", pid,</span><br><span class="line">					solution_id, lang_ext[lang], pid, solution_id,</span><br><span class="line">					lang_ext[lang - 1]);</span><br><span class="line"></span><br><span class="line">	&#125; else &#123;</span><br><span class="line"></span><br><span class="line">		FILE * pf;</span><br><span class="line">		pf = fopen("sim", "r");</span><br><span class="line">		if (pf) &#123;</span><br><span class="line">			fscanf(pf, "%d%d", &amp;sim, &amp;sim_s_id);</span><br><span class="line">			fclose(pf);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	if (solution_id &lt;= sim_s_id)</span><br><span class="line">		sim = 0;</span><br><span class="line">	return sim;</span><br><span class="line">&#125;</span><br><span class="line">void mk_shm_workdir(char * work_dir) &#123;</span><br><span class="line">	char shm_path[BUFFER_SIZE];</span><br><span class="line">	sprintf(shm_path, "/dev/shm/hustoj/%s", work_dir);</span><br><span class="line">	execute_cmd("/bin/mkdir -p %s", shm_path);</span><br><span class="line">	execute_cmd("/bin/ln -s %s %s/", shm_path, oj_home);</span><br><span class="line">	execute_cmd("/bin/chown judge %s ", shm_path);</span><br><span class="line">	execute_cmd("chmod 755 %s ", shm_path);</span><br><span class="line">	//sim need a soft link in shm_dir to work correctly</span><br><span class="line">	sprintf(shm_path, "/dev/shm/hustoj/%s/", oj_home);</span><br><span class="line">	execute_cmd("/bin/ln -s %s/data %s", oj_home, shm_path);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">int count_in_files(char * dirpath) &#123;</span><br><span class="line">	const char * cmd = "ls -l %s/*.in|wc -l";</span><br><span class="line">	int ret = 0;</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, dirpath);</span><br><span class="line">	fscanf(fjobs, "%d", &amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int get_test_file(char* work_dir, int p_id) &#123;</span><br><span class="line">	char filename[BUFFER_SIZE];</span><br><span class="line">	char localfile[BUFFER_SIZE];</span><br><span class="line">	int ret = 0;</span><br><span class="line">	const char * cmd =</span><br><span class="line">			" wget --post-data=\"gettestdatalist=1&amp;pid=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, p_id, http_baseurl);</span><br><span class="line">	while (fgets(filename, BUFFER_SIZE - 1, fjobs) != NULL) &#123;</span><br><span class="line">		sscanf(filename, "%s", filename);</span><br><span class="line">		if(http_judge&amp;&amp;(!data_list_has(filename))) data_list_add(filename);</span><br><span class="line">		sprintf(localfile, "%s/data/%d/%s", oj_home, p_id, filename);</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("localfile[%s]\n", localfile);</span><br><span class="line"></span><br><span class="line">		const char * check_file_cmd =</span><br><span class="line">				" wget --post-data=\"gettestdatadate=1&amp;filename=%d/%s\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O -  \"%s/admin/problem_judge.php\"";</span><br><span class="line">		FILE * rcop = read_cmd_output(check_file_cmd, p_id, filename,</span><br><span class="line">				http_baseurl);</span><br><span class="line">		time_t remote_date, local_date;</span><br><span class="line">		fscanf(rcop, "%ld", &amp;remote_date);</span><br><span class="line">		fclose(rcop);</span><br><span class="line">		struct stat fst;</span><br><span class="line">		stat(localfile, &amp;fst);</span><br><span class="line">		local_date = fst.st_mtime;</span><br><span class="line"></span><br><span class="line">		if (access(localfile, 0) == -1 || local_date &lt; remote_date) &#123;</span><br><span class="line"></span><br><span class="line">			if (strcmp(filename, "spj") == 0)</span><br><span class="line">				continue;</span><br><span class="line">			execute_cmd("/bin/mkdir -p %s/data/%d", oj_home, p_id);</span><br><span class="line">			const char * cmd2 =</span><br><span class="line">					" wget --post-data=\"gettestdata=1&amp;filename=%d/%s\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O \"%s\"  \"%s/admin/problem_judge.php\"";</span><br><span class="line">			execute_cmd(cmd2, p_id, filename, localfile, http_baseurl);</span><br><span class="line">			ret++;</span><br><span class="line"></span><br><span class="line">			if (strcmp(filename, "spj.c") == 0) &#123;</span><br><span class="line">				//   sprintf(localfile,"%s/data/%d/spj.c",oj_home,p_id);</span><br><span class="line">				if (access(localfile, 0) == 0) &#123;</span><br><span class="line">					const char * cmd3 = "gcc -o %s/data/%d/spj %s/data/%d/spj.c";</span><br><span class="line">					execute_cmd(cmd3, oj_home, p_id, oj_home, p_id);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			if (strcmp(filename, "spj.cc") == 0) &#123;</span><br><span class="line">				//     sprintf(localfile,"%s/data/%d/spj.cc",oj_home,p_id);</span><br><span class="line">				if (access(localfile, 0) == 0) &#123;</span><br><span class="line">					const char * cmd4 =</span><br><span class="line">							"g++ -o %s/data/%d/spj %s/data/%d/spj.cc";</span><br><span class="line">					execute_cmd(cmd4, oj_home, p_id, oj_home, p_id);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">void print_call_array() &#123;</span><br><span class="line">	printf("int LANG_%sV[256]=&#123;", LANG_NAME);</span><br><span class="line">	int i = 0;</span><br><span class="line">	for (i = 0; i &lt; call_array_size; i++) &#123;</span><br><span class="line">		if (call_counter[i]) &#123;</span><br><span class="line">			printf("%d,", i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	printf("0&#125;;\n");</span><br><span class="line"></span><br><span class="line">	printf("int LANG_%sC[256]=&#123;", LANG_NAME);</span><br><span class="line">	for (i = 0; i &lt; call_array_size; i++) &#123;</span><br><span class="line">		if (call_counter[i]) &#123;</span><br><span class="line">			printf("HOJ_MAX_LIMIT,");</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	printf("0&#125;;\n");</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line"></span><br><span class="line">	char work_dir[BUFFER_SIZE];</span><br><span class="line">	//char cmd[BUFFER_SIZE];</span><br><span class="line">	char user_id[BUFFER_SIZE];</span><br><span class="line">	int solution_id = 1000;</span><br><span class="line">	int runner_id = 0;</span><br><span class="line">	int p_id, time_lmt, mem_lmt, lang, isspj, sim, sim_s_id, max_case_time = 0;</span><br><span class="line"></span><br><span class="line">	init_parameters(argc, argv, solution_id, runner_id);</span><br><span class="line"></span><br><span class="line">	init_mysql_conf();</span><br><span class="line"></span><br><span class="line">	if (!http_judge &amp;&amp; !init_mysql_conn()) &#123;</span><br><span class="line">		exit(0); //exit if mysql is down</span><br><span class="line">	&#125;</span><br><span class="line">	//set work directory to start running &amp; judging</span><br><span class="line">	sprintf(work_dir, "%s/run%s/", oj_home, argv[2]);</span><br><span class="line"></span><br><span class="line">	clean_workdir(work_dir);</span><br><span class="line">	if (shm_run)</span><br><span class="line">		mk_shm_workdir(work_dir);</span><br><span class="line"></span><br><span class="line">	chdir(work_dir);</span><br><span class="line">	</span><br><span class="line">	if (http_judge)</span><br><span class="line">		system("/bin/ln -s ../cookie ./");</span><br><span class="line">	get_solution_info(solution_id, p_id, user_id, lang);</span><br><span class="line">	//get the limit</span><br><span class="line"></span><br><span class="line">	if (p_id == 0) &#123;</span><br><span class="line">		time_lmt = 5;</span><br><span class="line">		mem_lmt = 128;</span><br><span class="line">		isspj = 0;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		get_problem_info(p_id, time_lmt, mem_lmt, isspj);</span><br><span class="line">	&#125;</span><br><span class="line">	//copy source file</span><br><span class="line"></span><br><span class="line">	get_solution(solution_id, work_dir, lang);</span><br><span class="line"></span><br><span class="line">	//java is lucky</span><br><span class="line">	if (lang &gt;= 3 &amp;&amp; lang != 10 &amp;&amp; lang != 13 &amp;&amp; lang != 14) &#123;  // Clang Clang++ not VM or Script</span><br><span class="line">		// the limit for java</span><br><span class="line">		time_lmt = time_lmt + java_time_bonus;</span><br><span class="line">		mem_lmt = mem_lmt + java_memory_bonus;</span><br><span class="line">		// copy java.policy</span><br><span class="line">		execute_cmd("/bin/cp %s/etc/java0.policy %s/java.policy", oj_home,</span><br><span class="line">				work_dir);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//never bigger than judged set value;</span><br><span class="line">	if (time_lmt &gt; 300 || time_lmt &lt; 1)</span><br><span class="line">		time_lmt = 300;</span><br><span class="line">	if (mem_lmt &gt; 1024 || mem_lmt &lt; 1)</span><br><span class="line">		mem_lmt = 1024;</span><br><span class="line"></span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("time: %d mem: %d\n", time_lmt, mem_lmt);</span><br><span class="line"></span><br><span class="line">	// compile</span><br><span class="line">	//      printf("%s\n",cmd);</span><br><span class="line">	// set the result to compiling</span><br><span class="line">	int Compile_OK;</span><br><span class="line"></span><br><span class="line">	Compile_OK = compile(lang,work_dir);</span><br><span class="line">	if (Compile_OK != 0) &#123;</span><br><span class="line">		addceinfo(solution_id);</span><br><span class="line">		update_solution(solution_id, OJ_CE, 0, 0, 0, 0, 0.0);</span><br><span class="line">		update_user(user_id);</span><br><span class="line">		update_problem(p_id);</span><br><span class="line">		if (!http_judge)</span><br><span class="line">			mysql_close(conn);</span><br><span class="line">		clean_workdir(work_dir);</span><br><span class="line">		write_log("compile error");</span><br><span class="line">		exit(0);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		update_solution(solution_id, OJ_RI, 0, 0, 0, 0, 0.0);</span><br><span class="line">		umount(work_dir);</span><br><span class="line">	&#125;</span><br><span class="line">	//exit(0);</span><br><span class="line">	// run</span><br><span class="line">	char fullpath[BUFFER_SIZE];</span><br><span class="line">	char infile[BUFFER_SIZE];</span><br><span class="line">	char outfile[BUFFER_SIZE];</span><br><span class="line">	char userfile[BUFFER_SIZE];</span><br><span class="line">	sprintf(fullpath, "%s/data/%d", oj_home, p_id); // the fullpath of data dir</span><br><span class="line"></span><br><span class="line">	// open DIRs</span><br><span class="line">	DIR *dp;</span><br><span class="line">	dirent *dirp;</span><br><span class="line">	// using http to get remote test data files</span><br><span class="line">	if (p_id &gt; 0 &amp;&amp; http_judge)</span><br><span class="line">		get_test_file(work_dir, p_id);</span><br><span class="line">	if (p_id &gt; 0 &amp;&amp; (dp = opendir(fullpath)) == NULL) &#123;</span><br><span class="line"></span><br><span class="line">		write_log("No such dir:%s!\n", fullpath);</span><br><span class="line">		if (!http_judge)</span><br><span class="line">			mysql_close(conn);</span><br><span class="line">		exit(-1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int ACflg, PEflg;</span><br><span class="line">	ACflg = PEflg = OJ_AC;</span><br><span class="line">	int namelen;</span><br><span class="line">	int usedtime = 0, topmemory = 0;</span><br><span class="line"></span><br><span class="line">	//create chroot for ruby bash python</span><br><span class="line">	if (lang == 4)</span><br><span class="line">		copy_ruby_runtime(work_dir);</span><br><span class="line">	if (lang == 5)</span><br><span class="line">		copy_bash_runtime(work_dir);</span><br><span class="line">	if (lang == 6)</span><br><span class="line">		copy_python_runtime(work_dir);</span><br><span class="line">	if (lang == 7)</span><br><span class="line">		copy_php_runtime(work_dir);</span><br><span class="line">	if (lang == 8)</span><br><span class="line">		copy_perl_runtime(work_dir);</span><br><span class="line">	if (lang == 9)</span><br><span class="line">		copy_mono_runtime(work_dir);</span><br><span class="line">	if (lang == 10)</span><br><span class="line">		copy_objc_runtime(work_dir);</span><br><span class="line">	if (lang == 11)</span><br><span class="line">		copy_freebasic_runtime(work_dir);</span><br><span class="line">	if (lang == 12)</span><br><span class="line">		copy_guile_runtime(work_dir);</span><br><span class="line">	if (lang == 15)</span><br><span class="line">		copy_lua_runtime(work_dir);</span><br><span class="line">	if (lang == 16)</span><br><span class="line">		copy_js_runtime(work_dir);</span><br><span class="line">	// read files and run</span><br><span class="line">	// read files and run</span><br><span class="line">	// read files and run</span><br><span class="line">	double pass_rate = 0.0;</span><br><span class="line">	int num_of_test = 0;</span><br><span class="line">	int finalACflg = ACflg;</span><br><span class="line">	if (p_id == 0) &#123;  //custom input running</span><br><span class="line">		printf("running a custom input...\n");</span><br><span class="line">		get_custominput(solution_id, work_dir);</span><br><span class="line">		init_syscalls_limits(lang);</span><br><span class="line">		pid_t pidApp = fork();</span><br><span class="line"></span><br><span class="line">		if (pidApp == 0) &#123;</span><br><span class="line">			run_solution(lang, work_dir, time_lmt, usedtime, mem_lmt);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			watch_solution(pidApp, infile, ACflg, isspj, userfile, outfile,</span><br><span class="line">					solution_id, lang, topmemory, mem_lmt, usedtime, time_lmt,</span><br><span class="line">					p_id, PEflg, work_dir);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		if (ACflg == OJ_TL) &#123;</span><br><span class="line">			usedtime = time_lmt * 1000;</span><br><span class="line">		&#125;</span><br><span class="line">		if (ACflg == OJ_RE) &#123;</span><br><span class="line">			if (DEBUG)</span><br><span class="line">				printf("add RE info of %d..... \n", solution_id);</span><br><span class="line">			addreinfo(solution_id);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			addcustomout(solution_id);</span><br><span class="line">		&#125;</span><br><span class="line">		update_solution(solution_id, OJ_TR, usedtime, topmemory &gt;&gt; 10, 0, 0, 0);</span><br><span class="line">		clean_workdir(work_dir);</span><br><span class="line">		exit(0);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	for (; (oi_mode || ACflg == OJ_AC|| ACflg == OJ_PE) &amp;&amp; (dirp = readdir(dp)) != NULL;) &#123;</span><br><span class="line"></span><br><span class="line">		namelen = isInFile(dirp-&gt;d_name); // check if the file is *.in or not</span><br><span class="line">		if (namelen == 0)</span><br><span class="line">			continue;</span><br><span class="line"></span><br><span class="line">		if(http_judge&amp;&amp;(!data_list_has(dirp-&gt;d_name))) </span><br><span class="line">			continue;</span><br><span class="line">	</span><br><span class="line">		prepare_files(dirp-&gt;d_name, namelen, infile, p_id, work_dir, outfile,</span><br><span class="line">				userfile, runner_id);</span><br><span class="line">		init_syscalls_limits(lang);</span><br><span class="line"></span><br><span class="line">		pid_t pidApp = fork();</span><br><span class="line"></span><br><span class="line">		if (pidApp == 0) &#123;</span><br><span class="line"></span><br><span class="line">			run_solution(lang, work_dir, time_lmt, usedtime, mem_lmt);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line"></span><br><span class="line">			num_of_test++;</span><br><span class="line"></span><br><span class="line">			watch_solution(pidApp, infile, ACflg, isspj, userfile, outfile,</span><br><span class="line">					solution_id, lang, topmemory, mem_lmt, usedtime, time_lmt,</span><br><span class="line">					p_id, PEflg, work_dir);</span><br><span class="line"></span><br><span class="line">			judge_solution(ACflg, usedtime, time_lmt, isspj, p_id, infile,</span><br><span class="line">					outfile, userfile, PEflg, lang, work_dir, topmemory,</span><br><span class="line">					mem_lmt, solution_id, num_of_test);</span><br><span class="line">			if (use_max_time) &#123;</span><br><span class="line">				max_case_time =</span><br><span class="line">						usedtime &gt; max_case_time ? usedtime : max_case_time;</span><br><span class="line">				usedtime = 0;</span><br><span class="line">			&#125;</span><br><span class="line">			//clean_session(pidApp);</span><br><span class="line">		&#125;</span><br><span class="line">		if (oi_mode) &#123;</span><br><span class="line">			if (ACflg == OJ_AC) &#123;</span><br><span class="line">				++pass_rate;</span><br><span class="line">			&#125;</span><br><span class="line">			if (finalACflg &lt; ACflg) &#123;</span><br><span class="line">				finalACflg = ACflg;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			ACflg = OJ_AC;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if (ACflg == OJ_AC &amp;&amp; PEflg == OJ_PE)</span><br><span class="line">		ACflg = OJ_PE;</span><br><span class="line">	if (sim_enable &amp;&amp; ACflg == OJ_AC &amp;&amp; (!oi_mode || finalACflg == OJ_AC)</span><br><span class="line">			&amp;&amp; lang &lt; 5) &#123; //bash don't supported</span><br><span class="line">		sim = get_sim(solution_id, lang, p_id, sim_s_id);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		sim = 0;</span><br><span class="line">	&#125;</span><br><span class="line">	//if(ACflg == OJ_RE)addreinfo(solution_id);</span><br><span class="line"></span><br><span class="line">	if ((oi_mode &amp;&amp; finalACflg == OJ_RE) || ACflg == OJ_RE) &#123;</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("add RE info of %d..... \n", solution_id);</span><br><span class="line">		addreinfo(solution_id);</span><br><span class="line">	&#125;</span><br><span class="line">	if (use_max_time) &#123;</span><br><span class="line">		usedtime = max_case_time;</span><br><span class="line">	&#125;</span><br><span class="line">	if (ACflg == OJ_TL) &#123;</span><br><span class="line">		usedtime = time_lmt * 1000;</span><br><span class="line">	&#125;</span><br><span class="line">	if (oi_mode) &#123;</span><br><span class="line">		if (num_of_test &gt; 0)</span><br><span class="line">			pass_rate /= num_of_test;</span><br><span class="line">		update_solution(solution_id, finalACflg, usedtime, topmemory &gt;&gt; 10, sim,</span><br><span class="line">				sim_s_id, pass_rate);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		update_solution(solution_id, ACflg, usedtime, topmemory &gt;&gt; 10, sim,</span><br><span class="line">				sim_s_id, 0);</span><br><span class="line">	&#125;</span><br><span class="line">	if ((oi_mode &amp;&amp; finalACflg == OJ_WA) || ACflg == OJ_WA) &#123;</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("add diff info of %d..... \n", solution_id);</span><br><span class="line">		if (!isspj)</span><br><span class="line">			adddiffinfo(solution_id);</span><br><span class="line">	&#125;</span><br><span class="line">	update_user(user_id);</span><br><span class="line">	update_problem(p_id);</span><br><span class="line">	clean_workdir(work_dir);</span><br><span class="line"></span><br><span class="line">	if (DEBUG)</span><br><span class="line">		write_log("result=%d", oi_mode ? finalACflg : ACflg);</span><br><span class="line">	if (!http_judge)</span><br><span class="line">		mysql_close(conn);</span><br><span class="line">	if (record_call) &#123;</span><br><span class="line">		print_call_array();</span><br><span class="line">	&#125;</span><br><span class="line">	closedir(dp);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/18/HUSTOJ-Judge-Client/" data-id="cj0v033zj000gssn01ipwgntm" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-HUSTOJ-Judge" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/18/HUSTOJ-Judge/" class="article-date">
  <time datetime="2017-03-18T07:36:30.000Z" itemprop="datePublished">2017-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/18/HUSTOJ-Judge/">HUSTOJ_Judge</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HUSTOJ-core"><a href="#HUSTOJ-core" class="headerlink" title="HUSTOJ core :"></a>HUSTOJ core :</h1><p>Judged:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Copyright 2008 sempr &lt;iamsempr@gmail.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * Refacted and modified by zhblue&lt;newsclan@gmail.com&gt; </span><br><span class="line"> * Bug report email newsclan@gmail.com</span><br><span class="line"> * </span><br><span class="line"> * This file is part of HUSTOJ.</span><br><span class="line"> *</span><br><span class="line"> * HUSTOJ is free software; you can redistribute it and/or modify</span><br><span class="line"> * it under the terms of the GNU General Public License as published by</span><br><span class="line"> * the Free Software Foundation; either version 2 of the License, or</span><br><span class="line"> * (at your option) any later version.</span><br><span class="line"> *</span><br><span class="line"> * HUSTOJ is distributed in the hope that it will be useful,</span><br><span class="line"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"> * GNU General Public License for more details.</span><br><span class="line"> *</span><br><span class="line"> * You should have received a copy of the GNU General Public License</span><br><span class="line"> * along with HUSTOJ. if not, see &lt;http://www.gnu.org/licenses/&gt;.</span><br><span class="line"> */</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;syslog.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdarg.h&gt;</span><br><span class="line">#include &lt;mysql/mysql.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;signal.h&gt;</span><br><span class="line">#include &lt;sys/resource.h&gt;</span><br><span class="line"></span><br><span class="line">#define BUFFER_SIZE 1024</span><br><span class="line">#define LOCKFILE "/var/run/judged.pid"</span><br><span class="line">#define LOCKMODE (S_IRUSR|S_IWUSR|S_IRGRP|S_IROTH)</span><br><span class="line">#define STD_MB 1048576</span><br><span class="line"></span><br><span class="line">#define OJ_WT0 0</span><br><span class="line">#define OJ_WT1 1</span><br><span class="line">#define OJ_CI 2</span><br><span class="line">#define OJ_RI 3</span><br><span class="line">#define OJ_AC 4</span><br><span class="line">#define OJ_PE 5</span><br><span class="line">#define OJ_WA 6</span><br><span class="line">#define OJ_TL 7</span><br><span class="line">#define OJ_ML 8</span><br><span class="line">#define OJ_OL 9</span><br><span class="line">#define OJ_RE 10</span><br><span class="line">#define OJ_CE 11</span><br><span class="line">#define OJ_CO 12</span><br><span class="line">static char lock_file[BUFFER_SIZE]=LOCKFILE;</span><br><span class="line">static char host_name[BUFFER_SIZE];</span><br><span class="line">static char user_name[BUFFER_SIZE];</span><br><span class="line">static char password[BUFFER_SIZE];</span><br><span class="line">static char db_name[BUFFER_SIZE];</span><br><span class="line">static char oj_home[BUFFER_SIZE];</span><br><span class="line">static char oj_lang_set[BUFFER_SIZE];</span><br><span class="line">static int port_number;</span><br><span class="line">static int max_running;</span><br><span class="line">static int sleep_time;</span><br><span class="line">static int sleep_tmp;</span><br><span class="line">static int oj_tot;</span><br><span class="line">static int oj_mod;</span><br><span class="line">static int http_judge = 0;</span><br><span class="line">static char http_baseurl[BUFFER_SIZE];</span><br><span class="line">static char http_username[BUFFER_SIZE];</span><br><span class="line">static char http_password[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">static int  oj_redis = 0;</span><br><span class="line">static char oj_redisserver[BUFFER_SIZE];</span><br><span class="line">static int  oj_redisport;</span><br><span class="line">static char oj_redisauth[BUFFER_SIZE];</span><br><span class="line">static char oj_redisqname[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static bool STOP = false;</span><br><span class="line">static int DEBUG = 0;</span><br><span class="line">static int ONCE = 0;</span><br><span class="line">static MYSQL *conn;</span><br><span class="line">static MYSQL_RES *res;</span><br><span class="line">static MYSQL_ROW row;</span><br><span class="line">//static FILE *fp_log;</span><br><span class="line">static char query[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">void call_for_exit(int s) &#123;</span><br><span class="line">	STOP = true;</span><br><span class="line">	printf("Stopping judged...\n");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void write_log(const char *fmt, ...) &#123;</span><br><span class="line">	va_list ap;</span><br><span class="line">	char buffer[4096];</span><br><span class="line">//	time_t          t = time(NULL);</span><br><span class="line">//	int             l;</span><br><span class="line">	sprintf(buffer, "%s/log/client.log", oj_home);</span><br><span class="line">	FILE *fp = fopen(buffer, "ae+");</span><br><span class="line">	if (fp == NULL) &#123;</span><br><span class="line">		fprintf(stderr, "openfile error!\n");</span><br><span class="line">		system("pwd");</span><br><span class="line">	&#125;</span><br><span class="line">	va_start(ap, fmt);</span><br><span class="line">	vsprintf(buffer, fmt, ap);</span><br><span class="line">	fprintf(fp, "%s\n", buffer);</span><br><span class="line">	if (DEBUG)</span><br><span class="line">		printf("%s\n", buffer);</span><br><span class="line">	va_end(ap);</span><br><span class="line">	fclose(fp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int after_equal(char * c) &#123;</span><br><span class="line">	int i = 0;</span><br><span class="line">	for (; c[i] != '\0' &amp;&amp; c[i] != '='; i++)</span><br><span class="line">		;</span><br><span class="line">	return ++i;</span><br><span class="line">&#125;</span><br><span class="line">void trim(char * c) &#123;</span><br><span class="line">	char buf[BUFFER_SIZE];</span><br><span class="line">	char * start, *end;</span><br><span class="line">	strcpy(buf, c);</span><br><span class="line">	start = buf;</span><br><span class="line">	while (isspace(*start))</span><br><span class="line">		start++;</span><br><span class="line">	end = start;</span><br><span class="line">	while (!isspace(*end))</span><br><span class="line">		end++;</span><br><span class="line">	*end = '\0';</span><br><span class="line">	strcpy(c, start);</span><br><span class="line">&#125;</span><br><span class="line">bool read_buf(char * buf, const char * key, char * value) &#123;</span><br><span class="line">	if (strncmp(buf, key, strlen(key)) == 0) &#123;</span><br><span class="line">		strcpy(value, buf + after_equal(buf));</span><br><span class="line">		trim(value);</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			printf("%s\n", value);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">void read_int(char * buf, const char * key, int * value) &#123;</span><br><span class="line">	char buf2[BUFFER_SIZE];</span><br><span class="line">	if (read_buf(buf, key, buf2))</span><br><span class="line">		sscanf(buf2, "%d", value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// read the configue file</span><br><span class="line">void init_mysql_conf() &#123;</span><br><span class="line">	FILE *fp = NULL;</span><br><span class="line">	char buf[BUFFER_SIZE];</span><br><span class="line">	host_name[0] = 0;</span><br><span class="line">	user_name[0] = 0;</span><br><span class="line">	password[0] = 0;</span><br><span class="line">	db_name[0] = 0;</span><br><span class="line">	port_number = 3306;</span><br><span class="line">	max_running = 3;</span><br><span class="line">	sleep_time = 1;</span><br><span class="line">	oj_tot = 1;</span><br><span class="line">	oj_mod = 0;</span><br><span class="line">	strcpy(oj_lang_set, "0,1,2,3");</span><br><span class="line">	fp = fopen("./etc/judge.conf", "r");</span><br><span class="line">	if (fp != NULL) &#123;</span><br><span class="line">		while (fgets(buf, BUFFER_SIZE - 1, fp)) &#123;</span><br><span class="line">			read_buf(buf, "OJ_HOST_NAME", host_name);</span><br><span class="line">			read_buf(buf, "OJ_USER_NAME", user_name);</span><br><span class="line">			read_buf(buf, "OJ_PASSWORD", password);</span><br><span class="line">			read_buf(buf, "OJ_DB_NAME", db_name);</span><br><span class="line">			read_int(buf, "OJ_PORT_NUMBER", &amp;port_number);</span><br><span class="line">			read_int(buf, "OJ_RUNNING", &amp;max_running);</span><br><span class="line">			read_int(buf, "OJ_SLEEP_TIME", &amp;sleep_time);</span><br><span class="line">			read_int(buf, "OJ_TOTAL", &amp;oj_tot);</span><br><span class="line"></span><br><span class="line">			read_int(buf, "OJ_MOD", &amp;oj_mod);</span><br><span class="line"></span><br><span class="line">			read_int(buf, "OJ_HTTP_JUDGE", &amp;http_judge);</span><br><span class="line">			read_buf(buf, "OJ_HTTP_BASEURL", http_baseurl);</span><br><span class="line">			read_buf(buf, "OJ_HTTP_USERNAME", http_username);</span><br><span class="line">			read_buf(buf, "OJ_HTTP_PASSWORD", http_password);</span><br><span class="line">			read_buf(buf, "OJ_LANG_SET", oj_lang_set);</span><br><span class="line">			</span><br><span class="line">			read_int(buf, "OJ_REDISENABLE", &amp;oj_redis);</span><br><span class="line">                        read_buf(buf, "OJ_REDISSERVER", oj_redisserver);</span><br><span class="line">                        read_int(buf, "OJ_REDISPORT", &amp;oj_redisport);</span><br><span class="line">                        read_buf(buf, "OJ_REDISAUTH", oj_redisauth);</span><br><span class="line">                        read_buf(buf, "OJ_REDISQNAME", oj_redisqname);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		sprintf(query,</span><br><span class="line">				"SELECT solution_id FROM solution WHERE language in (%s) and result&lt;2 and MOD(solution_id,%d)=%d ORDER BY result ASC,solution_id ASC limit %d",</span><br><span class="line">				oj_lang_set, oj_tot, oj_mod, max_running * 2);</span><br><span class="line">		sleep_tmp = sleep_time;</span><br><span class="line">		//	fclose(fp);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void run_client(int runid, int clientid) &#123;</span><br><span class="line">	char buf[BUFFER_SIZE], runidstr[BUFFER_SIZE];</span><br><span class="line">	struct rlimit LIM;</span><br><span class="line">	LIM.rlim_max = 800;</span><br><span class="line">	LIM.rlim_cur = 800;</span><br><span class="line">	setrlimit(RLIMIT_CPU, &amp;LIM);</span><br><span class="line"></span><br><span class="line">	LIM.rlim_max = 180 * STD_MB;</span><br><span class="line">	LIM.rlim_cur = 180 * STD_MB;</span><br><span class="line">	setrlimit(RLIMIT_FSIZE, &amp;LIM);</span><br><span class="line"></span><br><span class="line">	LIM.rlim_max = STD_MB &lt;&lt; 11;</span><br><span class="line">	LIM.rlim_cur = STD_MB &lt;&lt; 11;</span><br><span class="line">	setrlimit(RLIMIT_AS, &amp;LIM);</span><br><span class="line"></span><br><span class="line">	LIM.rlim_cur = LIM.rlim_max = 200;</span><br><span class="line">	setrlimit(RLIMIT_NPROC, &amp;LIM);</span><br><span class="line"></span><br><span class="line">	//buf[0]=clientid+'0'; buf[1]=0;</span><br><span class="line">	sprintf(runidstr, "%d", runid);</span><br><span class="line">	sprintf(buf, "%d", clientid);</span><br><span class="line"></span><br><span class="line">	//write_log("sid=%s\tclient=%s\toj_home=%s\n",runidstr,buf,oj_home);</span><br><span class="line">	//sprintf(err,"%s/run%d/error.out",oj_home,clientid);</span><br><span class="line">	//freopen(err,"a+",stderr);</span><br><span class="line"></span><br><span class="line">	if (!DEBUG)</span><br><span class="line">		execl("/usr/bin/judge_client", "/usr/bin/judge_client", runidstr, buf,</span><br><span class="line">				oj_home, (char *) NULL);</span><br><span class="line">	else</span><br><span class="line">		execl("/usr/bin/judge_client", "/usr/bin/judge_client", runidstr, buf,</span><br><span class="line">				oj_home, "debug", (char *) NULL);</span><br><span class="line"></span><br><span class="line">	//exit(0);</span><br><span class="line">&#125;</span><br><span class="line">int executesql(const char * sql) &#123;</span><br><span class="line"></span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql))) &#123;</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			write_log("%s", mysql_error(conn));</span><br><span class="line">		sleep(20);</span><br><span class="line">		conn = NULL;</span><br><span class="line">		return 1;</span><br><span class="line">	&#125; else</span><br><span class="line">		return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int init_mysql() &#123;</span><br><span class="line">	if (conn == NULL) &#123;</span><br><span class="line">		conn = mysql_init(NULL);		// init the database connection</span><br><span class="line">		/* connect the database */</span><br><span class="line">		const char timeout = 30;</span><br><span class="line">		mysql_options(conn, MYSQL_OPT_CONNECT_TIMEOUT, &amp;timeout);</span><br><span class="line"></span><br><span class="line">		if (!mysql_real_connect(conn, host_name, user_name, password, db_name,</span><br><span class="line">				port_number, 0, 0)) &#123;</span><br><span class="line">			if (DEBUG)</span><br><span class="line">				write_log("%s", mysql_error(conn));</span><br><span class="line">			sleep(2);</span><br><span class="line">			return 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return 0;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		return executesql("set names utf8");</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">FILE * read_cmd_output(const char * fmt, ...) &#123;</span><br><span class="line">	char cmd[BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">	FILE * ret = NULL;</span><br><span class="line">	va_list ap;</span><br><span class="line"></span><br><span class="line">	va_start(ap, fmt);</span><br><span class="line">	vsprintf(cmd, fmt, ap);</span><br><span class="line">	va_end(ap);</span><br><span class="line">	//if(DEBUG) printf("%s\n",cmd);</span><br><span class="line">	ret = popen(cmd, "r");</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">int read_int_http(FILE * f) &#123;</span><br><span class="line">	char buf[BUFFER_SIZE];</span><br><span class="line">	fgets(buf, BUFFER_SIZE - 1, f);</span><br><span class="line">	return atoi(buf);</span><br><span class="line">&#125;</span><br><span class="line">bool check_login() &#123;</span><br><span class="line">	const char * cmd =</span><br><span class="line">			"wget --post-data=\"checklogin=1\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	int ret = 0;</span><br><span class="line"></span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, http_baseurl);</span><br><span class="line">	ret = read_int_http(fjobs);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">	return ret &gt; 0;</span><br><span class="line">&#125;</span><br><span class="line">void login() &#123;</span><br><span class="line">	if (!check_login()) &#123;</span><br><span class="line">		char cmd[BUFFER_SIZE];</span><br><span class="line">		sprintf(cmd,</span><br><span class="line">				"wget --post-data=\"user_id=%s&amp;password=%s\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/login.php\"",</span><br><span class="line">				http_username, http_password, http_baseurl);</span><br><span class="line">		system(cmd);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">int _get_jobs_http(int * jobs) &#123;</span><br><span class="line">	login();</span><br><span class="line">	int ret = 0;</span><br><span class="line">	int i = 0;</span><br><span class="line">	char buf[BUFFER_SIZE];</span><br><span class="line">	const char * cmd =</span><br><span class="line">			"wget --post-data=\"getpending=1&amp;oj_lang_set=%s&amp;max_running=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, oj_lang_set, max_running, http_baseurl);</span><br><span class="line">	while (fscanf(fjobs, "%s", buf) != EOF) &#123;</span><br><span class="line">		//puts(buf);</span><br><span class="line">		int sid = atoi(buf);</span><br><span class="line">		if (sid &gt; 0)</span><br><span class="line">			jobs[i++] = sid;</span><br><span class="line">		//i++;</span><br><span class="line">	&#125;</span><br><span class="line">	pclose(fjobs);</span><br><span class="line">	ret = i;</span><br><span class="line">	while (i &lt;= max_running * 2)</span><br><span class="line">		jobs[i++] = 0;</span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">int _get_jobs_mysql(int * jobs) &#123;</span><br><span class="line">	if (mysql_real_query(conn, query, strlen(query))) &#123;</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			write_log("%s", mysql_error(conn));</span><br><span class="line">		sleep(20);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	res = mysql_store_result(conn);</span><br><span class="line">	int i = 0;</span><br><span class="line">	int ret = 0;</span><br><span class="line">	while ((row = mysql_fetch_row(res)) != NULL) &#123;</span><br><span class="line">		jobs[i++] = atoi(row[0]);</span><br><span class="line">	&#125;</span><br><span class="line">	ret = i;</span><br><span class="line">	while (i &lt;= max_running * 2)</span><br><span class="line">		jobs[i++] = 0;</span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int _get_jobs_redis(int * jobs)&#123;</span><br><span class="line">        int ret=0;</span><br><span class="line">        const char * cmd="redis-cli -h %s -p %d -a %s --raw rpop %s";</span><br><span class="line">        while(ret&lt;=max_running)&#123;</span><br><span class="line">                FILE * fjobs = read_cmd_output(cmd,oj_redisserver,oj_redisport,oj_redisauth,oj_redisqname);</span><br><span class="line">                if(fscanf(fjobs,"%d",&amp;jobs[ret])==1)&#123;</span><br><span class="line">                        ret++;</span><br><span class="line">                        pclose(fjobs);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                        pclose(fjobs);</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        int i=ret;</span><br><span class="line">        while (i &lt;= max_running * 2)</span><br><span class="line">                jobs[i++] = 0;</span><br><span class="line">        if(DEBUG) printf("redis return %d jobs",ret);</span><br><span class="line">        return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int get_jobs(int * jobs) &#123;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		return _get_jobs_http(jobs);</span><br><span class="line">	&#125; else &#123;		</span><br><span class="line">		if(oj_redis)&#123;</span><br><span class="line">                        return _get_jobs_redis(jobs);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                        return _get_jobs_mysql(jobs);</span><br><span class="line">                &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool _check_out_mysql(int solution_id, int result) &#123;</span><br><span class="line">	char sql[BUFFER_SIZE];</span><br><span class="line">	sprintf(sql,</span><br><span class="line">			"UPDATE solution SET result=%d,time=0,memory=0,judgetime=NOW() WHERE solution_id=%d and result&lt;2 LIMIT 1",</span><br><span class="line">			result, solution_id);</span><br><span class="line">	if (mysql_real_query(conn, sql, strlen(sql))) &#123;</span><br><span class="line">		syslog(LOG_ERR | LOG_DAEMON, "%s", mysql_error(conn));</span><br><span class="line">		return false;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		if (mysql_affected_rows(conn) &gt; 0ul)</span><br><span class="line">			return true;</span><br><span class="line">		else</span><br><span class="line">			return false;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool _check_out_http(int solution_id, int result) &#123;</span><br><span class="line">	login();</span><br><span class="line">	const char * cmd =</span><br><span class="line">			"wget --post-data=\"checkout=1&amp;sid=%d&amp;result=%d\" --load-cookies=cookie --save-cookies=cookie --keep-session-cookies -q -O - \"%s/admin/problem_judge.php\"";</span><br><span class="line">	int ret = 0;</span><br><span class="line">	FILE * fjobs = read_cmd_output(cmd, solution_id, result, http_baseurl);</span><br><span class="line">	fscanf(fjobs, "%d", &amp;ret);</span><br><span class="line">	pclose(fjobs);</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line">bool check_out(int solution_id, int result) &#123;</span><br><span class="line">        if(oj_redis) return true;</span><br><span class="line">	if (http_judge) &#123;</span><br><span class="line">		return _check_out_http(solution_id, result);</span><br><span class="line">	&#125; else</span><br><span class="line">		return _check_out_mysql(solution_id, result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">int work() &#123;</span><br><span class="line">//      char buf[1024];</span><br><span class="line">	static int retcnt = 0;</span><br><span class="line">	int i = 0;</span><br><span class="line">	static pid_t ID[100];</span><br><span class="line">	static int workcnt = 0;</span><br><span class="line">	int runid = 0;</span><br><span class="line">	int jobs[max_running * 2 + 1];</span><br><span class="line">	pid_t tmp_pid = 0;</span><br><span class="line"></span><br><span class="line">	//for(i=0;i&lt;max_running;i++)&#123;</span><br><span class="line">	//      ID[i]=0;</span><br><span class="line">	//&#125;</span><br><span class="line"></span><br><span class="line">	//sleep_time=sleep_tmp;</span><br><span class="line">	/* get the database info */</span><br><span class="line">	if (!get_jobs(jobs))</span><br><span class="line">		retcnt = 0;</span><br><span class="line">	/* exec the submit */</span><br><span class="line">	for (int j = 0; jobs[j] &gt; 0; j++) &#123;</span><br><span class="line">		runid = jobs[j];</span><br><span class="line">		if (runid % oj_tot != oj_mod)</span><br><span class="line">			continue;</span><br><span class="line">		if (DEBUG)</span><br><span class="line">			write_log("Judging solution %d", runid);</span><br><span class="line">		if (workcnt &gt;= max_running) &#123;           // if no more client can running</span><br><span class="line">			tmp_pid = waitpid(-1, NULL, 0);     // wait 4 one child exit</span><br><span class="line">			for (i = 0; i &lt; max_running; i++)&#123;     // get the client id</span><br><span class="line">				if (ID[i] == tmp_pid)&#123;</span><br><span class="line">					workcnt--;</span><br><span class="line">					retcnt++;</span><br><span class="line">					ID[i] = 0;</span><br><span class="line">					break; // got the client id</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;                                             // have free client</span><br><span class="line"></span><br><span class="line">			for (i = 0; i &lt; max_running; i++)     // find the client id</span><br><span class="line">				if (ID[i] == 0)</span><br><span class="line">					break;    // got the client id</span><br><span class="line">		&#125;</span><br><span class="line">		if(i&lt;max_running)&#123;</span><br><span class="line">			if (workcnt &lt; max_running &amp;&amp; check_out(runid, OJ_CI)) &#123;</span><br><span class="line">				workcnt++;</span><br><span class="line">				ID[i] = fork();                                   // start to fork</span><br><span class="line">				if (ID[i] == 0) &#123;</span><br><span class="line">					if (DEBUG)</span><br><span class="line">						write_log("&lt;&lt;=sid=%d===clientid=%d==&gt;&gt;\n", runid, i);</span><br><span class="line">					run_client(runid, i);    // if the process is the son, run it</span><br><span class="line">					exit(0);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				ID[i] = 0;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	while ((tmp_pid = waitpid(-1, NULL, WNOHANG)) &gt; 0) &#123;</span><br><span class="line">		for (i = 0; i &lt; max_running; i++)&#123;     // get the client id</span><br><span class="line">			if (ID[i] == tmp_pid)&#123;</span><br><span class="line">			</span><br><span class="line">				workcnt--;</span><br><span class="line">				retcnt++;</span><br><span class="line">				ID[i] = 0;</span><br><span class="line">				break; // got the client id</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		printf("tmp_pid = %d\n", tmp_pid);</span><br><span class="line">	&#125;</span><br><span class="line">	if (!http_judge) &#123;</span><br><span class="line">		mysql_free_result(res);                         // free the memory</span><br><span class="line">		executesql("commit");</span><br><span class="line">	&#125;</span><br><span class="line">	if (DEBUG &amp;&amp; retcnt)</span><br><span class="line">		write_log("&lt;&lt;%ddone!&gt;&gt;", retcnt);</span><br><span class="line">	//free(ID);</span><br><span class="line">	//free(jobs);</span><br><span class="line">	return retcnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int lockfile(int fd) &#123;</span><br><span class="line">	struct flock fl;</span><br><span class="line">	fl.l_type = F_WRLCK;</span><br><span class="line">	fl.l_start = 0;</span><br><span class="line">	fl.l_whence = SEEK_SET;</span><br><span class="line">	fl.l_len = 0;</span><br><span class="line">	return (fcntl(fd, F_SETLK, &amp;fl));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int already_running() &#123;</span><br><span class="line">	int fd;</span><br><span class="line">	char buf[16];</span><br><span class="line">	fd = open(lock_file, O_RDWR | O_CREAT, LOCKMODE);</span><br><span class="line">	if (fd &lt; 0) &#123;</span><br><span class="line">		syslog(LOG_ERR | LOG_DAEMON, "can't open %s: %s", LOCKFILE,</span><br><span class="line">				strerror(errno));</span><br><span class="line">		exit(1);</span><br><span class="line">	&#125;</span><br><span class="line">	if (lockfile(fd) &lt; 0) &#123;</span><br><span class="line">		if (errno == EACCES || errno == EAGAIN) &#123;</span><br><span class="line">			close(fd);</span><br><span class="line">			return 1;</span><br><span class="line">		&#125;</span><br><span class="line">		syslog(LOG_ERR | LOG_DAEMON, "can't lock %s: %s", LOCKFILE,</span><br><span class="line">				strerror(errno));</span><br><span class="line">		exit(1);</span><br><span class="line">	&#125;</span><br><span class="line">	ftruncate(fd, 0);</span><br><span class="line">	sprintf(buf, "%d", getpid());</span><br><span class="line">	write(fd, buf, strlen(buf) + 1);</span><br><span class="line">	return (0);</span><br><span class="line">&#125;</span><br><span class="line">int daemon_init(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	pid_t pid;</span><br><span class="line"></span><br><span class="line">	if ((pid = fork()) &lt; 0)</span><br><span class="line">		return (-1);</span><br><span class="line"></span><br><span class="line">	else if (pid != 0)</span><br><span class="line">		exit(0); /* parent exit */</span><br><span class="line"></span><br><span class="line">	/* child continues */</span><br><span class="line"></span><br><span class="line">	setsid(); /* become session leader */</span><br><span class="line"></span><br><span class="line">	chdir(oj_home); /* change working directory */</span><br><span class="line"></span><br><span class="line">	umask(0); /* clear file mode creation mask */</span><br><span class="line"></span><br><span class="line">	close(0); /* close stdin */</span><br><span class="line">	close(1); /* close stdout */</span><br><span class="line">	</span><br><span class="line">	close(2); /* close stderr */</span><br><span class="line">	</span><br><span class="line">	int fd = open( "/dev/null", O_RDWR );</span><br><span class="line">	dup2( fd, 0 );</span><br><span class="line">	dup2( fd, 1 );</span><br><span class="line">	dup2( fd, 2 );</span><br><span class="line">	if ( fd &gt; 2 )&#123;</span><br><span class="line">		close( fd );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return (0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line">	DEBUG = (argc &gt; 2);</span><br><span class="line">	ONCE = (argc &gt; 3);</span><br><span class="line">	if (argc &gt; 1)</span><br><span class="line">		strcpy(oj_home, argv[1]);</span><br><span class="line">	else</span><br><span class="line">		strcpy(oj_home, "/home/judge");</span><br><span class="line">	chdir(oj_home);    // change the dir</span><br><span class="line"></span><br><span class="line">	sprintf(lock_file,"%s/etc/judge.pid",oj_home);</span><br><span class="line">	if (!DEBUG)</span><br><span class="line">		daemon_init();</span><br><span class="line">	if ( already_running()) &#123;</span><br><span class="line">		syslog(LOG_ERR | LOG_DAEMON,</span><br><span class="line">				"This daemon program is already running!\n");</span><br><span class="line">		printf("%s already has one judged on it!\n",oj_home);</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	if(!DEBUG)</span><br><span class="line">		system("/sbin/iptables -A OUTPUT -m owner --uid-owner judge -j DROP");</span><br><span class="line">//	struct timespec final_sleep;</span><br><span class="line">//	final_sleep.tv_sec=0;</span><br><span class="line">//	final_sleep.tv_nsec=500000000;</span><br><span class="line">	init_mysql_conf();	// set the database info</span><br><span class="line">	signal(SIGQUIT, call_for_exit);</span><br><span class="line">	signal(SIGKILL, call_for_exit);</span><br><span class="line">	signal(SIGTERM, call_for_exit);</span><br><span class="line">	int j = 1;</span><br><span class="line">	while (1) &#123;			// start to run</span><br><span class="line">		while (j &amp;&amp; (http_judge || !init_mysql())) &#123;</span><br><span class="line"></span><br><span class="line">			j = work();</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		if(ONCE) break;</span><br><span class="line">		sleep(sleep_time);</span><br><span class="line">		j = 1;</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/18/HUSTOJ-Judge/" data-id="cj0v033yy000fssn0jkf3sdxd" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017-03-04" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/04/2017-03-04/" class="article-date">
  <time datetime="2017-03-04T08:14:42.000Z" itemprop="datePublished">2017-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/04/2017-03-04/">国创数据处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、根据支持度置信度划分位点"><a href="#1、根据支持度置信度划分位点" class="headerlink" title="1、根据支持度置信度划分位点"></a>1、根据支持度置信度划分位点</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Point&#123;</span><br><span class="line">    <span class="keyword">int</span> num ;</span><br><span class="line">    <span class="keyword">double</span> a , b ;</span><br><span class="line">    Point()&#123;&#125; ;</span><br><span class="line">    Point(<span class="keyword">int</span> _num , <span class="keyword">double</span> _a , <span class="keyword">double</span> _b)&#123;</span><br><span class="line">        num = _num ;</span><br><span class="line">        a = _a ;</span><br><span class="line">        b = _b ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;point[<span class="number">1000</span>];</span><br><span class="line"></span><br><span class="line">Point tmp1[<span class="number">1000</span>] , tmp2[<span class="number">1000</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(Point x , Point y)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x.a &lt; y.a ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp2</span><span class="params">(Point x , Point y)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x.b &lt; y.b ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num ;</span><br><span class="line">    <span class="keyword">double</span> a , b ;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d %lf %lf"</span>,&amp;num,&amp;a,&amp;b))&#123;</span><br><span class="line">        point[cnt].num = num ;</span><br><span class="line">        point[cnt].a = a ;</span><br><span class="line">        point[cnt++].b = b ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; i ++)&#123;</span><br><span class="line">        tmp1[i] = point[i] ;</span><br><span class="line">        tmp2[i] = point[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::sort(tmp1,tmp1+cnt,cmp1) ;</span><br><span class="line">    <span class="built_in">std</span>::sort(tmp2,tmp2+cnt,cmp2) ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; i ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; cnt ; j ++)&#123;</span><br><span class="line">            <span class="keyword">double</span> aa = tmp1[i].a ;</span><br><span class="line">            <span class="keyword">double</span> bb = tmp2[i].b ;</span><br><span class="line">            <span class="keyword">bool</span> flag = <span class="literal">false</span> ;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt; cnt ; k ++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(point[k].a &gt;= aa &amp;&amp; point[k].b &gt;= bb)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span> ;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"%d-"</span>,point[k].num) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">" %lf %lf\n\n"</span>,aa,bb) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、去除重复数据与格式化输出"><a href="#2、去除重复数据与格式化输出" class="headerlink" title="2、去除重复数据与格式化输出"></a>2、去除重复数据与格式化输出</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> s[<span class="number">100</span>][<span class="number">10000</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Point&#123;</span><br><span class="line">    <span class="keyword">double</span> a , b ;</span><br><span class="line">    </span><br><span class="line">&#125;point[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>,<span class="keyword">int</span>&gt; m ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> tmp[<span class="number">10000</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ta , tb ;</span><br><span class="line">    m.clear() ;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%s %lf %lf"</span>,tmp,&amp;ta,&amp;tb))&#123;</span><br><span class="line">        <span class="keyword">if</span>(m[tmp] ==<span class="number">0</span>)&#123;</span><br><span class="line">            m[tmp] = cnt ;</span><br><span class="line">            point[cnt].a = ta ;</span><br><span class="line">            point[cnt].b = tb ;</span><br><span class="line">            <span class="keyword">int</span> l = <span class="built_in">strlen</span>(tmp) ;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; l ; i ++)&#123;</span><br><span class="line">                s[cnt][i] = tmp[i] ;</span><br><span class="line">            &#125;</span><br><span class="line">            cnt ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> ttt = m[tmp] ;</span><br><span class="line">            point[ttt].a = <span class="built_in">std</span>::min(point[ttt].a,ta) ;</span><br><span class="line">            point[ttt].b = <span class="built_in">std</span>::min(point[ttt].b,tb) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">strlen</span>(s[i]) ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; l ; j ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i][j] == <span class="string">'-'</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">" "</span>) ;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%c"</span>,s[i][j]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>) ;</span><br><span class="line">        <span class="comment">//printf(" %lf %lf\n",point[i].a,point[i].b) ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/04/2017-03-04/" data-id="cj0v033y30008ssn0bqufsux0" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-HDU5115" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/08/HDU5115/" class="article-date">
  <time datetime="2016-10-08T11:28:16.000Z" itemprop="datePublished">2016-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/HDU5115/">HDU5115</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HDU5115"><a href="#HDU5115" class="headerlink" title="HDU5115"></a>HDU5115</h1><h2 id="Dire-Wolf"><a href="#Dire-Wolf" class="headerlink" title="Dire Wolf"></a>Dire Wolf</h2><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5115" target="_blank" rel="external">题目链接</a></p>
<h3 id="题意："><a href="#题意：" class="headerlink" title="题意："></a>题意：</h3><p>有N只狼，每个狼有属性a和b，每杀一只狼i都会受到a[i] + b[i-1] + b[i+1] 的伤害，求将所有狼打死受到的最小伤害。</p>
<h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><p>相机包区间DP(DP还是要靠缘分。。。。)</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000005</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">205</span>][<span class="number">205</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">205</span>] ;</span><br><span class="line"><span class="keyword">int</span> b[<span class="number">205</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> u , <span class="keyword">int</span> v)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u == v)</span><br><span class="line">        <span class="keyword">return</span> dp[u][v] = a[u] + b[u<span class="number">-1</span>] + b[u+<span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">if</span>(dp[u][v] != inf)</span><br><span class="line">        <span class="keyword">return</span> dp[u][v] ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = u ; i &lt; v ; i ++)&#123;</span><br><span class="line">        dp[u][v] = <span class="built_in">std</span>::min(solve(u,i) + solve(i+<span class="number">1</span>,v) + <span class="built_in">std</span>::min(b[v+<span class="number">1</span>] - b[i+<span class="number">1</span>] , b[u<span class="number">-1</span>] - b[i]), dp[u][v]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[u][v] ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"in.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>) ;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// ONLINE_JUDGE</span></span></span><br><span class="line">    <span class="keyword">int</span> t ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t) ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> <span class="keyword">_t</span> = <span class="number">1</span> ; <span class="keyword">_t</span> &lt;= t ; <span class="keyword">_t</span> ++)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp,inf,<span class="keyword">sizeof</span> dp) ;</span><br><span class="line">        <span class="keyword">int</span> n ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; i ++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; i ++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;b[i]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        a[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">        b[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">        a[n+<span class="number">1</span>] = <span class="number">0</span> ;</span><br><span class="line">        b[n+<span class="number">1</span>] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">int</span> ans = solve(<span class="number">1</span>,n) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>,<span class="keyword">_t</span>,ans) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/08/HDU5115/" data-id="cj0v033yw000essn04jxokna2" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-05-21" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/22/2016-05-21/" class="article-date">
  <time datetime="2016-05-22T08:27:36.000Z" itemprop="datePublished">2016-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/22/2016-05-21/">HZAU_Training_2016_05_21(for 15th)Report</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-CF675C"><a href="#A-CF675C" class="headerlink" title="A CF675C"></a>A CF675C</h2><p>题意大致为有n个银行，所有银行中的钱的总和为0，可以将第i个银行中的钱转移到与其相邻的银行中（第一个与第n个一行相邻），求最少多少次转移可以将所有银行中的钱都变成0.<br>将k个银行中的钱转移到一个银行中需要k－1步，所以，求最小的步数即为求和为0的区间最多的数量。<br>另s[i]表示前i个数的和，若s[i] = s[j] (j &lt; i &amp;&amp; j &gt; 0)，表示j到i区间内所有数的和为0.<br>这样，可以将问题简化为求哪个数出现的次数最多，放入map中即可。</p>
<p>代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span> ,<span class="keyword">int</span> &gt; m ;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) ;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t ;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> sum = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">int</span> ans = n - <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;t) ;</span><br><span class="line">        sum += t ;</span><br><span class="line">        m[sum] ++ ;</span><br><span class="line">        ans = <span class="built_in">std</span>::min(ans,n-m[sum]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="B-HDU-5688"><a href="#B-HDU-5688" class="headerlink" title="B HDU 5688"></a>B HDU 5688</h2><p>将所给字符串排序，放入map统计数量即可。map只能统计string的数量。</p>
<h2 id="C-HDU-1248"><a href="#C-HDU-1248" class="headerlink" title="C HDU 1248"></a>C HDU 1248</h2><p>背包或者别的玄学乱搞</p>
<h2 id="D-HDU-5438"><a href="#D-HDU-5438" class="headerlink" title="D HDU 5438"></a>D HDU 5438</h2><p>嗯，吉利的题号。。。。题意为每次去掉度为1的点，并且删掉那条边。模拟拓扑序的过程，最后dfs即可。(忽略下面的toop，，应该是topo）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Edge&#123;</span><br><span class="line">    <span class="keyword">public</span> :</span><br><span class="line">    <span class="keyword">int</span> u,v,next ;</span><br><span class="line">&#125;edge[<span class="number">200005</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[<span class="number">10005</span>] ;</span><br><span class="line"><span class="keyword">int</span> d[<span class="number">10005</span>] ;</span><br><span class="line"><span class="keyword">int</span> s[<span class="number">10005</span>] ;</span><br><span class="line"><span class="keyword">int</span> e , n , m , num ;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> sum ;</span><br><span class="line"><span class="keyword">bool</span> vis[<span class="number">10005</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> temp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    sum += s[temp] ;</span><br><span class="line">    num ++ ;</span><br><span class="line">    vis[temp] = <span class="literal">true</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[temp] ; i != <span class="number">-1</span> ; i = edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v ;</span><br><span class="line">        <span class="keyword">if</span>(!vis[v])</span><br><span class="line">            dfs(v);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    edge[e].u = u ;</span><br><span class="line">    edge[e].next = head[u] ;</span><br><span class="line">    edge[e].v = v ;</span><br><span class="line">    head[u] = e ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">toop</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q ;</span><br><span class="line">    <span class="keyword">while</span>(!q.empty()) q.pop() ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; i ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d[i] == <span class="number">1</span>)&#123;</span><br><span class="line">            q.push(i) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = q.front();</span><br><span class="line">        q.pop() ;</span><br><span class="line">        vis[temp] = <span class="literal">true</span> ;</span><br><span class="line">        d[temp] -- ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = head[temp] ; i != <span class="number">-1</span> ; i = edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v ;</span><br><span class="line">            <span class="keyword">if</span>(d[v] &gt; <span class="number">0</span> )&#123;</span><br><span class="line">                d[v] -- ;</span><br><span class="line">                <span class="keyword">if</span>(d[v] == <span class="number">1</span>)</span><br><span class="line">                    q.push(v) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t) ;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        e = <span class="number">0</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="keyword">sizeof</span> d) ;</span><br><span class="line">        <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span> head) ;</span><br><span class="line">        <span class="built_in">memset</span>(vis,<span class="literal">false</span>,<span class="keyword">sizeof</span> vis) ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m) ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; i ++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;s[i]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; m ; i ++)&#123;</span><br><span class="line">            <span class="keyword">int</span> u,v ;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;u,&amp;v) ;</span><br><span class="line">            d[u] ++ ;</span><br><span class="line">            d[v] ++ ;</span><br><span class="line">            add(u,v) ;</span><br><span class="line">            add(v,u) ;</span><br><span class="line">        &#125;</span><br><span class="line">        toop() ;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;=n ; i ++ )&#123;</span><br><span class="line">            num = <span class="number">0</span> ;</span><br><span class="line">            sum = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">if</span>(d[i] &gt; <span class="number">0</span> &amp;&amp; !vis[i])&#123;</span><br><span class="line">                dfs(i) ;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(num % <span class="number">2</span>)</span><br><span class="line">                    ans += sum ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="E-HDU-5410"><a href="#E-HDU-5410" class="headerlink" title="E HDU 5410"></a>E HDU 5410</h2><p>01背包＋完全背包乱搞。。。。</p>
<h2 id="F-HDU-5253"><a href="#F-HDU-5253" class="headerlink" title="F HDU 5253"></a>F HDU 5253</h2><p>先处理出每个点到周围点的距离，求一个最小生成树即可。点的数量较多，邻接矩阵会爆。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Edge&#123;</span><br><span class="line">    <span class="keyword">public</span> :</span><br><span class="line">    <span class="keyword">int</span> u,v,w ;</span><br><span class="line">&#125;edge[<span class="number">2000001</span>];</span><br><span class="line"><span class="keyword">int</span> s[<span class="number">1000001</span>] ;</span><br><span class="line"><span class="keyword">int</span> e , n , m ;</span><br><span class="line"><span class="keyword">int</span> F[<span class="number">1000001</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    edge[e].u = u ;</span><br><span class="line">    edge[e].v = v ;</span><br><span class="line">    edge[e++].w = w ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(Edge a,Edge b)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.w &lt; b.w ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(F[x] == <span class="number">-1</span> )</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> F[x] = find(F[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Kru</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::sort(edge,edge+e,cmp) ;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; e ; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> u = edge[i].u ;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v ;</span><br><span class="line">        <span class="keyword">int</span> w = edge[i].w ;</span><br><span class="line">        <span class="keyword">int</span> t1 = find(u) ;</span><br><span class="line">        <span class="keyword">int</span> t2 = find(v) ;</span><br><span class="line">        <span class="keyword">if</span>(t1 != t2)&#123;</span><br><span class="line">            ans += w ;</span><br><span class="line">            F[t1] = t2 ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> <span class="keyword">_t</span> = <span class="number">1</span> ; <span class="keyword">_t</span> &lt;= t ; <span class="keyword">_t</span> ++)&#123;</span><br><span class="line">        e = <span class="number">0</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(F,<span class="number">-1</span> ,<span class="keyword">sizeof</span> F) ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m) ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n*m ; i ++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;s[i]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n*m ; i ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i % m != m<span class="number">-1</span>)&#123;</span><br><span class="line">                add(i,i+<span class="number">1</span>,<span class="built_in">abs</span>(s[i]-s[i+<span class="number">1</span>])) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i/m != n<span class="number">-1</span>)&#123;</span><br><span class="line">                add(i,i+m,<span class="built_in">abs</span>(s[i]-s[i+m])) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d:\n%d\n"</span>,<span class="keyword">_t</span>,Kru()) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="G-POJ-1094"><a href="#G-POJ-1094" class="headerlink" title="G POJ 1094"></a>G POJ 1094</h2><p>每次接收一组就进行一次拓扑排序，判断是否满足条件。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> s[<span class="number">30</span>][<span class="number">30</span>];</span><br><span class="line"><span class="keyword">int</span> d[<span class="number">30</span>],q[<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Toposort</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">1</span> ,loc,num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++)&#123;</span><br><span class="line">        temp[i] = d[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; n ; j ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(temp[j] == <span class="number">0</span>)&#123;</span><br><span class="line">                m++;</span><br><span class="line">                loc = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        temp[loc] = <span class="number">-1</span> ;</span><br><span class="line">        q[num++] = loc;</span><br><span class="line">        <span class="keyword">if</span>(m == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(m &gt; <span class="number">1</span>)</span><br><span class="line">            res = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; n ; j ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[loc][j] == <span class="number">1</span>)</span><br><span class="line">                temp[j] -- ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n , m ;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m))&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span> &amp;&amp; m == <span class="number">0</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">char</span> in[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">bool</span> flag = <span class="literal">false</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="keyword">sizeof</span> d);</span><br><span class="line">        <span class="built_in">memset</span>(s,<span class="number">0</span>,<span class="keyword">sizeof</span> s);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; i ++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,in);</span><br><span class="line">            <span class="keyword">int</span> a = in[<span class="number">0</span>] - <span class="string">'A'</span> ;</span><br><span class="line">            <span class="keyword">int</span> b = in[<span class="number">2</span>] - <span class="string">'A'</span> ;</span><br><span class="line">            s[a][b] = <span class="number">1</span> ;</span><br><span class="line">            d[b] ++ ;</span><br><span class="line">            <span class="keyword">if</span>(flag)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> ttt = Toposort(n);</span><br><span class="line">            <span class="keyword">if</span>(ttt == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Sorted sequence determined after %d relations: "</span>,i);</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; n ; j ++)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"%c"</span>,q[j]+<span class="string">'A'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">".\n"</span>);</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(ttt == <span class="number">0</span> )&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Inconsistency found after %d relations.\n"</span>,i);</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Sorted sequence cannot be determined.\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="H-POJ-1062"><a href="#H-POJ-1062" class="headerlink" title="H POJ 1062"></a>H POJ 1062</h2><p>最短路</p>
<h2 id="I-POJ-2240"><a href="#I-POJ-2240" class="headerlink" title="I POJ 2240"></a>I POJ 2240</h2><p>同最短路floyd。。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/22/2016-05-21/" data-id="cj0v033xv0005ssn0yzhdzdgv" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-HDU2159" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/06/HDU2159/" class="article-date">
  <time datetime="2016-04-06T13:20:34.000Z" itemprop="datePublished">2016-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/06/HDU2159/">HDU2159</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HDU-2159"><a href="#HDU-2159" class="headerlink" title="HDU 2159"></a>HDU 2159</h2><p>原来写题解时以为是01背包，经提醒发现是个二维的完全背包＝ ＝ ｜｜真是惭愧。。。。<br>背包存储的是杀怪得到的经验，dp[i][j]表示消耗体力i，杀怪j个时得到的经验是多少。<br>状态转移方程：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=cost[i];j&lt;=m;j++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=s;x++)</span><br><span class="line">            dp[j][x]=max(dp[j][x],dp[j-cost[i]][x<span class="number">-1</span>]+<span class="built_in">exp</span>[i]);</span><br></pre></td></tr></table></figure></p>
<p>完整代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF=<span class="number">-1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">123</span>][<span class="number">123</span>];</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">exp</span>[<span class="number">123</span>],cost[<span class="number">123</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,k,s;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>,&amp;n,&amp;m,&amp;k,&amp;s))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;<span class="built_in">exp</span>[i],&amp;cost[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=cost[i];j&lt;=m;j++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">1</span>;x&lt;=s;x++)</span><br><span class="line">                    dp[j][x]=max(dp[j][x],dp[j-cost[i]][x<span class="number">-1</span>]+<span class="built_in">exp</span>[i]);</span><br><span class="line">        <span class="keyword">int</span> flag=<span class="number">0</span>,loc;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=m;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(flag)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=s;j++)</span><br><span class="line">                <span class="keyword">if</span>(dp[i][j]&gt;=n)</span><br><span class="line">                &#123;</span><br><span class="line">                    flag=<span class="number">1</span>;</span><br><span class="line">                    loc=i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(flag)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,m-loc);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/06/HDU2159/" data-id="cj0v033xw0006ssn0mv62z0am" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/29/my-ls-md/">my_ls</a>
          </li>
        
          <li>
            <a href="/2017/03/29/ipc-shm-md/">ipc_shm.md</a>
          </li>
        
          <li>
            <a href="/2017/03/29/ipc-sem-md/">ipc_sem.md</a>
          </li>
        
          <li>
            <a href="/2017/03/29/ipc-msg-md/">ipc_msg</a>
          </li>
        
          <li>
            <a href="/2017/03/18/HUSTOJ-Judge-Client/">HUSTOJ_Judge_Client</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 InsomniA<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>